<!-- base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Get started with a free and open source Tailwind CSS admin dashboard featuring a sidebar layout, advanced charts, and hundreds of components based on Flowbite">
    <meta name="author" content="Themesberg">
    <meta name="generator" content="Hugo 0.107.0">

    <title>{% block title %}{% endblock %}</title>
   
    <link rel="canonical" href="https://themesberg.com/product/tailwind-css/dashboard-windster">
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" href="{% static 'img\favicon.ico' %}">
    <link rel="mask-icon" href="https://demo.themesberg.com/windster/safari-pinned-tab.svg" color="#5bbad5">
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">    


    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
    <meta name="twitter:title" content="Tailwind CSS Dashboard - Windster">
    <meta name="twitter:description" content="Get started with a free and open source Tailwind CSS admin dashboard featuring a sidebar layout, advanced charts, and hundreds of components based on Flowbite">
    <meta name="twitter:image" content="https://demo.themesberg.com/windster/">

    <!-- Facebook -->
    <meta property="og:url" content="https://demo.themesberg.com/windster/">
    <meta property="og:title" content="Tailwind CSS Dashboard - Windster">
    <meta property="og:description" content="Get started with a free and open source Tailwind CSS admin dashboard featuring a sidebar layout, advanced charts, and hundreds of components based on Flowbite">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://demo.themesberg.com/docs/images/og-image.jpg">
    <meta property="og:image:type" content="image/png">

    <!-- Alpine.js -->
    <script src="//unpkg.com/alpinejs" defer></script>

    
  </head>
  <body class="bg-gray-500">
  

    {% include "includes/nav.html" %}
    <div class="flex overflow-hidden bg-white pt-16">

      {% include "includes/aside.html" %}

      <div class="bg-gray-900 opacity-50 hidden fixed inset-0 z-10" id="sidebarBackdrop"></div>

      <div id="main-content" class="h-full w-full bg-gray-500 relative overflow-y-auto lg:ml-64">
        {% block 'body' %}{% endblock  %}
        
        <div id="spinner-container" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75 hidden">
          <div class="flex space-x-2">
            <div class="w-4 h-4 bg-blue-500 rounded-full animate-bounce delay-100"></div>
            <div class="w-4 h-4 bg-green-500 rounded-full animate-bounce delay-300"></div>
            <div class="w-4 h-4 bg-yellow-500 rounded-full animate-bounce delay-500"></div>
          </div>
        </div>
        {% include "includes/footer.html" %}

      </div>

    </div>

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="{% static 'js/app.bundle.js' %}"></script>
    <script src="../path/to/fullcalendar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <script>
        // Controle do spinner
        function showSpinner() {
          document.getElementById('spinner-container').classList.remove('hidden');
        }
      
        function hideSpinner() {
          document.getElementById('spinner-container').classList.add('hidden');
        }
      
        // Exemplo de uso durante o carregamento
        document.addEventListener('DOMContentLoaded', function() {
          hideSpinner(); // Esconde quando tudo carregar
        });
        
        // Mostrar spinner antes do carregamento da página
        window.addEventListener('beforeunload', function() {
          showSpinner();
        });
      </script>
    

    {% block js %}{% endblock js %}

    {% block floating_elements %}
    <!-- Botão Flutuante do Faisca -->
    <button id="faiscaButton" 
            class="fixed bottom-6 right-6 w-14 h-14 rounded-full flex items-center justify-center text-white bg-gradient-to-r from-teal-400 to-teal-600 shadow-lg hover:shadow-xl transition-all hover:scale-105 animate-bounce">
        <i class="fas fa-dog text-2xl"></i>
    </button>
    
    <!-- Modal do Chat Faisca -->
    <div id="faiscaModal" class="hidden fixed inset-0 z-[999] flex items-end justify-end p-4 md:p-6">
        <div class="w-full max-w-md bg-gray-800 rounded-t-xl shadow-2xl border border-gray-700 flex flex-col" style="height: 70vh; max-height: 700px;">
            <!-- Cabeçalho -->
            <div class="flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900 rounded-t-xl">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center">
                        <i class="fas fa-dog text-xl text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-white">Faisca AI</h3>
                        <p class="text-xs text-amber-400">Assistente de Inteligência</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button id="resetFaiscaButton" class="p-2 text-gray-400 hover:text-amber-400 transition">
                        <i class="fas fa-eraser"></i>
                    </button>
                    <button id="closeFaiscaButton" class="p-2 text-gray-400 hover:text-red-400 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- Área de Mensagens -->
            <div id="faiscaChat" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-800/50 custom-scrollbar">
                <div class="flex justify-center py-4">
                    <div class="bg-gray-900/50 text-gray-400 text-sm px-4 py-2 rounded-full">
                        <i class="fas fa-dog mr-2 text-amber-500"></i>
                        Olá, como posso ajudar hoje?
                    </div>
                </div>
            </div>
            
            <!-- Área de Input -->
            <div class="p-4 border-t border-gray-700 bg-gray-900 rounded-b-xl">
                <div class="relative flex">
                    <input type="text" 
                           id="faiscaInput"
                           class="flex-1 bg-gray-700 text-white placeholder-gray-400 border border-gray-600 rounded-l-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 pr-12"
                           placeholder="Digite sua mensagem...">
                    <button id="sendFaiscaButton" 
                            class="px-4 bg-gradient-to-br from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white rounded-r-lg transition">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2">Faisca AI pode cometer erros. Verifique informações importantes.</p>
            </div>
        </div>
    </div>
    
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #f59e0b;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }
        
        .markdown-content h1 {
            font-size: 1.5em;
            border-bottom: 1px solid #4b5563;
            padding-bottom: 0.3em;
        }
        
        .markdown-content h2 {
            font-size: 1.3em;
        }
        
        .markdown-content h3 {
            font-size: 1.1em;
        }
        
        .markdown-content p {
            margin-bottom: 1em;
            line-height: 1.6;
        }
        
        .markdown-content ul, .markdown-content ol {
            margin-left: 1.5em;
            margin-bottom: 1em;
        }
        
        .markdown-content li {
            margin-bottom: 0.5em;
        }
        
        .markdown-content code {
            background-color: #374151;
            color: #f3f4f6;
            padding: 0.2em 0.4em;
            border-radius: 0.3em;
            font-family: monospace;
        }
        
        .markdown-content pre {
            background-color: #1f2937;
            padding: 1em;
            border-radius: 0.5em;
            overflow-x: auto;
            margin-bottom: 1em;
        }
        
        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
        }
        
        .markdown-content blockquote {
            border-left: 4px solid #f59e0b;
            padding-left: 1em;
            margin-left: 0;
            color: #9ca3af;
        }
        
        .dot-flashing {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #f59e0b;
            color: #f59e0b;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: .5s;
        }
        
        .dot-flashing::before, .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
        }
        
        .dot-flashing::before {
            left: -15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #f59e0b;
            color: #f59e0b;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }
        
        .dot-flashing::after {
            left: 15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #f59e0b;
            color: #f59e0b;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }
        
        @keyframes dotFlashing {
            0% {
                background-color: #f59e0b;
            }
            50%, 100% {
                background-color: #6b7280;
            }
        }
    </style>
    
    <script>
      // Função para obter o cookie CSRF
      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }
     
      // Aguarda o DOM estar completamente carregado
      document.addEventListener('DOMContentLoaded', function() {
          // Elementos do DOM
          const faiscaButton = document.getElementById('faiscaButton');
          const faiscaModal = document.getElementById('faiscaModal');
          const closeFaiscaButton = document.getElementById('closeFaiscaButton');
          const resetFaiscaButton = document.getElementById('resetFaiscaButton');
          const sendFaiscaButton = document.getElementById('sendFaiscaButton');
          const faiscaInput = document.getElementById('faiscaInput');
          const faiscaChat = document.getElementById('faiscaChat');
     
          // Função para abrir o modal
          function openFaiscaModal() {
              console.log('Abrindo modal Faisca');
              faiscaModal.classList.remove('hidden');
              document.body.style.overflow = 'hidden';
              faiscaInput.focus();
          }
     
          // Função para fechar o modal
          function closeFaiscaModal() {
              faiscaModal.classList.add('hidden');
              document.body.style.overflow = 'auto';
          }
     
          // Função para resetar o chat
          async function resetFaiscaChat() {
              if (confirm('Tem certeza que deseja limpar o chat?')) {
                  try {
                      const response = await fetch('/faisca/agent/reset', {
                          method: 'POST',
                          headers: {
                              'X-CSRFToken': getCookie('csrftoken'),
                              'X-Requested-With': 'XMLHttpRequest'
                          }
                      });
     
                      if (!response.ok) {
                          throw new Error('Falha ao resetar o chat');
                      }
     
                      faiscaChat.innerHTML = `
                          <div class="flex justify-center py-4">
                              <div class="bg-gray-900/50 text-gray-400 text-sm px-4 py-2 rounded-full">
                                  <i class="fas fa-dog mr-2 text-amber-500"></i>
                                  Olá, como posso ajudar hoje?
                              </div>
                          </div>
                      `;
                  } catch (error) {
                      console.error('Erro ao resetar chat:', error);
                      alert('Ocorreu um erro ao resetar o chat');
                  }
              }
          }
     
          // Função para adicionar mensagem ao chat
          function addFaiscaMessage(sender, message) {
              const messageDiv = document.createElement('div');
              messageDiv.className = `flex justify-${sender === 'user' ? 'end' : 'start'} mb-4`;
              messageDiv.innerHTML = `
                  <div class="flex space-x-2">
                      <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">
                          <i class="fas fa-dog text-amber-500"></i>
                      </div>
                      <div class="bg-gray-700 text-white rounded-xl rounded-tl-none px-4 py-2">
                          <div class="flex space-x-2 items-center">
                              <div class="flex space-x-1">
                                  <div class="w-2 h-2 bg-amber-400 rounded-full animate-bounce"></div>
                                  <div class="w-2 h-2 bg-amber-400 rounded-full animate-bounce delay-100"></div>
                                  <div class="w-2 h-2 bg-amber-400 rounded-full animate-bounce delay-200"></div>
                              </div>
                              <span class="text-sm">${message}</span>
                          </div>
                      </div>
                  </div>
              `;
              faiscaChat.appendChild(messageDiv);
              smoothScrollToBottom();
          }
     
          // Função para enviar mensagem
          async function sendFaiscaMessage() {
              const message = faiscaInput.value.trim();
              if (!message) return;
     
              addFaiscaMessage('user', message);
              faiscaInput.value = '';
     
              // Adiciona loading
              const loadingDiv = document.createElement('div');
              loadingDiv.className = 'flex justify-start mb-4';
              loadingDiv.innerHTML = `
                  <div class="flex space-x-2">
                      <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">
                          <i class="fas fa-dog text-amber-500"></i>
                      </div>
                      <div class="bg-gray-700 text-white rounded-xl rounded-tl-none px-4 py-2">
                          <div class="flex space-x-2 items-center">
                              <div class="flex space-x-1">
                                  <div class="w-2 h-2 bg-amber-400 rounded-full animate-bounce"></div>
                                  <div class="w-2 h-2 bg-amber-400 rounded-full animate-bounce delay-100"></div>
                                  <div class="w-2 h-2 bg-amber-400 rounded-full animate-bounce delay-200"></div>
                              </div>
                              <span class="text-sm">Processando...</span>
                          </div>
                      </div>
                  </div>
              `;
              faiscaChat.appendChild(loadingDiv);
              smoothScrollToBottom();
     
              try {
                  const response = await fetch('/faisca/agent/chat/', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                          'X-CSRFToken': getCookie('csrftoken'),
                          'X-Requested-With': 'XMLHttpRequest'
                      },
                      body: JSON.stringify({ message: message })
                  });
     
                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }
     
                  const data = await response.json();
     
                  // Remove loading
                  loadingDiv.remove();
     
                  if (data.error) {
                      addFaiscaMessage('faisca', `Erro: ${data.error}`);
                  } else if (data.response) {
                      addFaiscaMessage('faisca', data.response);
                  } else {
                      addFaiscaMessage('faisca', "Resposta vazia do servidor");
                  }
     
              } catch (error) {
                  console.error('Erro:', error);
                  loadingDiv.remove();
                  addFaiscaMessage('faisca', `Erro: ${error.message}`);
         }
     }

     // Função para scroll suave
     function smoothScrollToBottom() {
         faiscaChat.scrollTo({
             top: faiscaChat.scrollHeight,
             behavior: 'smooth'
         });
     }

     // Event listeners
     faiscaButton.addEventListener('click', openFaiscaModal);
     closeFaiscaButton.addEventListener('click', closeFaiscaModal);
     resetFaiscaButton.addEventListener('click', resetFaiscaChat);
     sendFaiscaButton.addEventListener('click', sendFaiscaMessage);

     faiscaInput.addEventListener('keypress', function(e) {
         if (e.key === 'Enter') {
             sendFaiscaMessage();
         }
     });

     // Fechar modal ao clicar fora
     faiscaModal.addEventListener('click', function(e) {
         if (e.target === faiscaModal) {
             closeFaiscaModal();
         }
     });

     // Fechar com ESC
     document.addEventListener('keydown', function(e) {
         if (e.key === 'Escape' && !faiscaModal.classList.contains('hidden')) {
             closeFaiscaModal();
         }
     });

     console.log('Chat Faisca inicializado com sucesso');
 });
</script>



    </script>
    {% endblock floating_elements %}

  </body>
</html>
