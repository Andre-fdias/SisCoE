<div id="novaSituacaoFuncionalModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm hidden">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl overflow-hidden transform transition-all duration-300">
        <div class="bg-gradient-to-r from-green-600 to-teal-700 p-6 flex items-center justify-between">
            <div>
                <h3 class="text-xl font-bold text-white flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Nova Situação Funcional
                </h3>
                <p class="text-blue-100 text-sm mt-1">Preencha todos os campos para o novo registro.</p>
            </div>
            <button type="button"
                    data-modal-close="novaSituacaoFuncionalModal"
                    class="text-blue-100 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <form id="novaSituacaoFuncionalForm" method="POST" action="{% url 'efetivo:nova_situacao_funcional' cadastro.id %}" class="p-6 space-y-6">
            {% csrf_token %}

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="relative z-0">
                    <select name="situacao" id="nova_situacao" required class="block w-full px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer">
                        <option value="" selected disabled>Selecione uma situação</option>
                        {% for choice in situacao_choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <label for="nova_situacao" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Situação <span class="text-red-500">*</span>
                    </label>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <div class="relative z-0">
                    <select name="sgb" id="nova_sgb" required class="block w-full px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer">
                        <option value="" selected disabled>Selecione o SGB</option>
                        {% for choice in sgb_choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <label for="nova_sgb" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        SGB <span class="text-red-500">*</span>
                    </label>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <div class="relative z-0">
                    <select name="posto_secao" id="nova_posto_secao" required class="block w-full px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer">
                        <option value="" selected disabled>Selecione Posto/Seção</option>
                        {% for choice in posto_secao_choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <label for="nova_posto_secao" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Posto/Seção <span class="text-red-500">*</span>
                    </label>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <div class="relative z-0">
                    <select name="esta_adido" id="nova_esta_adido" class="block w-full px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer">
                        <option value="" selected>Não adido</option>
                        {% for choice in esta_adido_choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <label for="nova_esta_adido" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Adido ao (opcional)
                    </label>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <div class="relative z-0">
                    <select name="funcao" id="nova_funcao" required class="block w-full px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer">
                        <option value="" selected disabled>Selecione a função</option>
                        {% for choice in funcao_choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <label for="nova_funcao" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Função <span class="text-red-500">*</span>
                    </label>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <div class="relative z-0">
                    <select name="prontidao" id="nova_prontidao" required class="block w-full px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer">
                        <option value="" selected disabled>Selecione a prontidão</option>
                        {% for choice in prontidao_choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <label for="nova_prontidao" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Prontidão <span class="text-red-500">*</span>
                    </label>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <div class="relative">
                    <input type="date" name="apresentacao_na_unidade" id="nova_apresentacao" required class="block px-4 py-3 w-full text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer"/>
                    <label for="nova_apresentacao" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Apresentação na Unidade <span class="text-red-500">*</span>
                    </label>
                </div>

                <div class="relative">
                    <input type="date" name="saida_da_unidade" id="nova_saida" class="block px-4 py-3 w-full text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent peer"/>
                    <label for="nova_saida" class="absolute text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-800 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3">
                        Saída da Unidade (opcional)
                    </label>
                </div>
            </div>

            <div class="flex justify-between pt-6 border-t border-gray-200 dark:border-gray-700">
                <button type="button" data-modal-close="novaSituacaoFuncionalModal"
                        class="px-5 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors
                              border border-gray-300 dark:border-gray-600">
                    Cancelar
                </button>
                <button type="submit"
                        class="px-5 py-2.5 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors
                              flex items-center gap-2 shadow-md hover:shadow-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Salvar Nova Situação
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Dados de mapeamento SGB -> Posto/Seção
        const postoSeccaoPorSGB = {
            "EM": [
                ["703150000 - CMT", "CMT"],
                ["703159000 - SUB CMT", "SUB CMT"],
                ["703159100 - SEC ADM", "SEC ADM"],
                ["703159110 - B/1 E B/5", "B/1 E B/5"],
                ["703159110-1 - B/5", "B/5"],
                ["703159120 - AA", "AA"],
                ["703159130 - B/3 E MOTOMEC", "B/3 E MOTOMEC"],
                ["703159130-1 - MOTOMEC", "MOTOMEC"],
                ["703159131 - COBOM", "COBOM"],
                ["703159140 - B/4", "B/4"],
                ["703159150 - ST UGE", "ST UGE"],
                ["703159160 - ST PJMD", "ST PJMD"],
                ["703159200 - SEC ATIV TEC", "SEC ATIV TEC"]
            ],
            "1ºSGB": [
                ["703151000 - CMT 1º SGB", "CMT 1º SGB"],
                ["703151100 - ADM PB CERRADO", "ADM PB CERRADO"],
                ["703151101 - EB CERRADO", "EB CERRADO"],
                ["703151102 - EB ZONA NORTE", "EB ZONA NORTE"],
                ["703151200 - ADM PB SANTA ROSÁLIA", "ADM PB SANTA ROSÁLIA"],
                ["703151201 - EB SANTA ROSÁLIA", "EB SANTA ROSÁLIA"],
                ["703151202 - EB ÉDEM", "EB ÉDEM"],
                ["703151300 - ADM PB VOTORANTIM", "ADM PB VOTORANTIM"],
                ["703151301 - EB VOTORANTIM", "EB VOTORANTIM"],
                ["703151302 - EB PIEDADE", "EB PIEDADE"],
                ["703151800 - ADM 1º SGB", "ADM 1º SGB"]
            ],
            "2ºSGB": [
                ["703152000 - CMT 2º SGB", "CMT 2º SGB"],
                ["703152100 - ADM PB ITU", "ADM PB ITU"],
                ["703152101 - EB ITU", "EB ITU"],
                ["703152102 - EB PORTO FELIZ", "EB PORTO FELIZ"],
                ["703152200 - ADM PB SALTO", "ADM PB SALTO"],
                ["703152201 - EB SALTO", "EB SALTO"],
                ["703152300 - ADM PB SÃO ROQUE", "ADM PB SÃO ROQUE"],
                ["703152301 - EB SÃO ROQUE", "EB SÃO ROQUE"],
                ["703152302 - EB IBIÚNA", "EB IBIÚNA"],
                ["703152800 - ADM 2º SGB", "ADM 2º SGB"],
                ["703152900 - NUCL ATIV TEC 2º SGB", "NUCL ATIV TEC 2º SGB"]
            ],
            "3ºSGB": [
                ["703153000 - CMT 3º SGB", "CMT 3º SGB"],
                ["703153100 - ADM PB ITAPEVA", "ADM PB ITAPEVA"],
                ["703153101 - EB ITAPEVA", "EB ITAPEVA"],
                ["703153102 - EB APIAÍ", "EB APIAÍ"],
                ["703153103 - EB ITARARÉ", "EB ITARARÉ"],
                ["703153104 - EB CAPÃO BONITO", "EB CAPÃO BONITO"],
                ["703153800 - ADM 3º SGB", "ADM 3º SGB"],
                ["703153900 - NUCL ATIV TEC 3º SGB", "NUCL ATIV TEC 3º SGB"]
            ],
            "4ºSGB": [
                ["703154000 - CMT 4º SGB", "CMT 4º SGB"],
                ["703154100 - ADM PB ITAPETININGA", "ADM PB ITAPETININGA"],
                ["703154101 - EB ITAPETININGA", "EB ITAPETININGA"],
                ["703154102 - EB BOITUVA", "EB BOITUVA"],
                ["703154103 - EB ANGATUBA", "EB ANGATUBA"],
                ["703154200 - ADM PB TATUÍ", "ADM PB TATUÍ"],
                ["703154201 - EB TATUÍ", "EB TATUÍ"],
                ["703154202 - EB TIETÊ", "EB TIETÊ"],
                ["703154203 - EB LARANJAL PAULISTA", "EB LARANJAL PAULISTA"],
                ["703154800 - ADM 4º SGB", "ADM 4º SGB"],
                ["703154900 - NUCL ATIV TEC 4º SGB", "NUCL ATIV TEC 4º SGB"]
            ],
            "5ºSGB": [
                ["703155000 - CMT 5º SGB", "CMT 5º SGB"],
                ["703155100 - ADM PB BOTUCATU", "ADM PB BOTUCATU"],
                ["703155101 - EB BOTUCATU", "EB BOTUCATU"],
                ["703155102 - EB ITATINGA", "EB ITATINGA"],
                ["703155200 - ADM PB AVARÉ", "ADM PB AVARÉ"],
                ["703155201 - EB AVARÉ", "EB AVARÉ"],
                ["703155202 - EB PIRAJU", "EB PIRAJU"],
                ["703155203 - EB ITAÍ", "EB ITAÍ"],
                ["703155800 - ADM 5º SGB", "ADM 5º SGB"],
                ["703155900 - NUCL ATIV TEC 5º SGB", "NUCL ATIV TEC 5º SGB"]
            ]
        };

        // Função para atualizar as opções do Posto/Seção
        function atualizarPostoSeccao() {
            const sgbSelect = document.getElementById('nova_sgb'); // Alterado para 'nova_sgb'
            const postoSeccaoSelect = document.getElementById('nova_posto_secao'); // Alterado para 'nova_posto_secao'
            const sgbSelecionado = sgbSelect.value;

            // Limpa as opções atuais e adiciona a opção padrão
            postoSeccaoSelect.innerHTML = '<option value="" disabled selected>Selecione o Posto/Seção</option>';
            // Desabilita o select de Posto/Seção se nenhum SGB for selecionado
            postoSeccaoSelect.disabled = !sgbSelecionado;

            // Se um SGB for selecionado e existir no mapeamento, preenche as opções
            if (sgbSelecionado && postoSeccaoPorSGB[sgbSelecionado]) {
                postoSeccaoPorSGB[sgbSelecionado].forEach(([value, label]) => {
                    const option = new Option(label, value);
                    postoSeccaoSelect.add(option);
                });
            }
        }

        // Inicializar o select de Posto/Seção como desabilitado e com a opção padrão
        const postoSeccaoSelectElement = document.getElementById('nova_posto_secao'); // Alterado para 'nova_posto_secao'
        if (postoSeccaoSelectElement) {
            postoSeccaoSelectElement.disabled = true;
            postoSeccaoSelectElement.innerHTML = '<option value="" disabled selected>Selecione o Posto/Seção</option>';
        }

        // Adicionar o event listener para o select de SGB
        const sgbSelectElement = document.getElementById('nova_sgb'); // Alterado para 'nova_sgb'
        if (sgbSelectElement) {
            sgbSelectElement.addEventListener('change', atualizarPostoSeccao);
            // Se já houver um valor selecionado no SGB (por exemplo, após um erro de validação do formulário),
            // atualiza as opções de Posto/Seção no carregamento da página.
            if (sgbSelectElement.value) {
                atualizarPostoSeccao();
            }
        }
    });
</script>