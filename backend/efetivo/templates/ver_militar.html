{% extends "base.html" %}
{% load static %}
{% load efetivo_filters %}
{% load cat_efetivo_tags %}

{% block title %} Consultar Efetivo{% endblock %}
{% block 'head' %}

<link rel="stylesheet" href="{% static 'efetivo\css\ver_militar.css' %}">


{% endblock 'head' %}

{% block 'body' %}
<style>
    @keyframes diagonal-scroll {
    0% { transform: translateY(-100%) translateX(-100%); }
    100% { transform: translateY(100%) translateX(100%); }
}

.diagonal-overlay {
    animation: diagonal-scroll 40s linear infinite;
    background-image: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(0,0,0,0.1) 10px,
        rgba(0,0,0,0.1) 20px
    );
}
</style>

<body>

    <div class=" md:items-center md:justify-between rounded-lg mt-4 w-full" id="cad_efetivo">   
        <fieldset class=" p-4 mb-8   rounded-md w-full" id="second-fieldset">   
        
            <fieldset class="p-4 mb-2 rounded-md w-full max-w-full" id="first-fieldset">
                <div class="bg-gradient-to-r from-gray-700 to-gray-900 rounded-2xl shadow-2xl w-full p-8 transition-all duration-300 animate-fade-in">
                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- Seção da Foto -->
                        <div class="flex-shrink-0 flex flex-col items-center md:block">
                            <div class="relative group overflow-hidden rounded-xl border-4 border-blue-400/30 shadow-xl hover:shadow-2xl transition-all duration-300 w-60 h-72">
                                {% if cadastro.imagens.exists %}
                                    {% with cadastro.promocoes.last as promocao %}
                                    <div class="relative">
                                        <!-- Padrão de fundo -->
                                        <div class="absolute inset-0 overflow-hidden">
                                            <div class="absolute inset-0 grid grid-cols-6 grid-rows-5 -rotate-45 gap-4 opacity-20 pointer-events-none">
                                                {% for _ in "x"|ljust:20 %}
                                                <span class="text-gray-200 text-xs font-mono tracking-wider transform rotate-45">
                                                    {{ request.user.profile.cpf|default:"CPF Não Cadastrado" }}
                                                </span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        
                                        <!-- Imagem com borda condicional -->
                                        {% if promocao.posto_grad == "Cel PM" or promocao.posto_grad == "Ten Cel PM" or promocao.posto_grad == "Maj PM" or promocao.posto_grad == "CAP PM" or promocao.posto_grad == "1º Ten PM" or promocao.posto_grad == "1º Ten QAPM" or promocao.posto_grad == "2º Ten PM" or promocao.posto_grad == "2º Ten QAPM" or promocao.posto_grad == "Asp OF PM" %}
                                            <img src="{{ cadastro.imagens.last.image.url }}" 
                                                 class="w-full h-full object-cover transform transition-transform duration-300 group-hover:scale-105"
                                                 alt="Foto de {{ cadastro.nome }}">
                                        {% elif promocao.posto_grad == "Subten PM" or promocao.posto_grad == "1º Sgt PM" or promocao.posto_grad == "2º Sgt PM" or promocao.posto_grad == "3º Sgt PM" %}
                                            <img src="{{ cadastro.imagens.last.image.url }}"
                                                 class="w-full h-full object-cover transform transition-transform duration-300 group-hover:scale-105"
                                                 alt="Foto de {{ cadastro.nome }}">
                                        {% elif promocao.posto_grad == "Cb PM" or promocao.posto_grad == "Sd PM" or promocao.posto_grad == "Sd PM 2ºCL" %}
                                            <img src="{{ cadastro.imagens.last.image.url }}"
                                                 class="w-full h-full object-cover transform transition-transform duration-300 group-hover:scale-105"
                                                 alt="Foto de {{ cadastro.nome }}">
                                        {% else %}
                                            <img src="{{ cadastro.imagens.last.image.url }}"
                                                 class="w-full h-full object-cover transform transition-transform duration-300 group-hover:scale-105"
                                                 alt="Foto de {{ cadastro.nome }}">
                                        {% endif %}
                                    </div>
                                    {% endwith %}
                                {% else %}
                                    <div class="w-full h-full bg-blue-200/20 flex flex-col items-center justify-center text-blue-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        <span class="text-lg font-medium">Sem imagem</span>
                                    </div>
                                {% endif %}
                            </div>
            

            
                            <!-- Botões -->
                            <div class="flex flex-col gap-3 mt-6">
                                <button type="button" data-modal-open="trocaFotoModal"
                                        class="bg-gradient-to-r from-emerald-400 to-cyan-500 hover:from-emerald-500 hover:to-cyan-600 text-white 
                                               font-medium rounded-lg py-2.5 transition-all duration-300 hover:shadow-lg
                                               flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    Trocar Foto
                                </button>
                                
                                <button type="button" data-modal-open="editarPostoGrad"
                                        class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white 
                                               font-medium rounded-lg py-2.5 transition-all duration-300 hover:shadow-lg
                                               flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"/>
                                    </svg>
                                    Editar Posto/Grad
                                </button>
                            </div>
                        </div>
            
                        <!-- Seção de Informações -->
                        <div class="flex-1 space-y-6">
                            <div class="space-y-2">
                                <h1 class="text-4xl font-bold text-white text-center md:text-left">{{ cadastro.nome }}</h1>
                                <p class="text-xl text-blue-200 text-center md:text-left">{{ cadastro.promocoes.last.grad|safe }}  {{ cadastro.re }}-{{ cadastro.dig }} {{ cadastro.nome_de_guerra }}</p>
                            </div>
            
                            <!-- Grid de Informações -->
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Informações de Contato -->
                                <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/50">
                                    <h2 class="text-xl font-semibold text-white mb-2 pb-2 border-b border-gray-600/50">
                                        <span class="bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">
                                            Informações de Contato
                                        </span>
                                    </h2>
                                    <ul class="space-y-4">
                                        <li class="flex items-start gap-3">
                                            <svg class="flex-shrink-0 w-6 h-6 text-blue-400 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                            </svg>
                                            <div>
                                                <p class="font-medium text-blue-200">E-mail Institucional</p>
                                                <p class="text-white break-all">{{ cadastro.email|default:"-" }}</p>
                                            </div>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <svg class="flex-shrink-0 w-6 h-6 text-blue-400 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                            </svg>
                                            <div>
                                                <p class="font-medium text-blue-200">Contato Telefônico</p>
                                                <p class="text-white">{{ cadastro.telefone|default:"-" }}</p>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
            
                                <!-- Situação Atual -->
                                <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/50">
                                    <h2 class="text-xl font-semibold text-white mb-2 pb-2 border-b border-gray-600/50">
                                        <span class="bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">
                                            Situação Atual
                                        </span>
                                    </h2>
                                    <ul class="space-y-4">
                                        <li class="flex items-start gap-3">
                                            <svg class="flex-shrink-0 w-6 h-6 text-blue-400 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            </svg>
                                            <div>
                                                <p class="font-medium text-blue-200">Localização/Posto</p>
                                                <p class="text-white">
                                                    {{ cadastro.detalhes_situacao.last.sgb|default:"-" }} -
                                                    {{ cadastro.detalhes_situacao.last.posto_secao|default:"-" }}
                                                </p>
                                            </div>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <svg class="flex-shrink-0 w-6 h-6 text-blue-400 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                            </svg>
                                            <div>
                                                <p class="font-medium text-blue-200">Última Atualização</p>
                                                <p class="text-white">
                                                    {{ cadastro.detalhes_situacao.last.modified|date:"d/m/Y"|default:"-" }}
                                                </p>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
            
                            <!-- Cursos -->
                            <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/50">
                                <h2 class="text-xl font-semibold text-white mb-4">
                                    <span class="bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">
                                        Principais Cursos
                                    </span>
                                </h2>
                                <div class="flex flex-wrap gap-2">
                                    {% if cursos_especiais %}
                                        {% for curso_nome in cursos_especiais %}
                                            <span class="bg-gradient-to-r from-yellow-700 to-yellow-600 text-blue-100 font-medium px-3 py-1 rounded-full text-sm">{{ curso_nome }}</span>
                                        {% endfor %}
                                    {% else %}
                                        <span class="text-gray-400 text-sm">Nenhum curso especial</span>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            
                <!-- Modals (manter mesma estrutura com ajustes de estilo) -->
                {% include 'modals/troca_foto.html' %}
                {% include 'modals/editar_posto.html' %}
                
            </fieldset>

            <!-- Adicione este script antes do fechamento do body -->
            <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        // Função para abrir modais
                        document.querySelectorAll('[data-modal-open]').forEach(button => {
                            button.addEventListener('click', () => {
                                const modalId = button.getAttribute('data-modal-open');
                                const modal = document.getElementById(modalId);
                                if(modal) modal.classList.remove('hidden');
                            });
                        });

                        // Função para fechar modais
                        document.querySelectorAll('[data-modal-close]').forEach(button => {
                            button.addEventListener('click', () => {
                                const modalId = button.getAttribute('data-modal-close');
                                const modal = document.getElementById(modalId);
                                if(modal) modal.classList.add('hidden');
                            });
                        });

                        // Fechar modal ao clicar fora
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.addEventListener('click', (e) => {
                                if(e.target === modal) modal.classList.add('hidden');
                            });
                        });
                    });
            </script>

            <fieldset class="rounded-md">
                {% if messages %}
                    <div id="django-messages" style="display:none;" data-messages='[
                        {% for message in messages %}
                            {
                                "tags": "{{ message.tags|upper }}",
                                "message": "{{ message|escapejs }}"
                            }{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ]'></div>
                {% endif %}
                    {% include 'modals/alert_modal.html' %}
            </fieldset>
            
            <style>
                .alert {
                    border-width: 1px;
                    border-style: solid;
                }
                
                .alert.info {
                    background-color: #f0f9ff;
                    border-color: #bae6fd;
                    color: #0369a1;
                }
                
                .alert.success {
                    background-color: #f0fdf4;
                    border-color: #bbf7d0;
                    color: #15803d;
                }
                
                .alert.warning {
                    background-color: #fefce8;
                    border-color: #fef08a;
                    color: #a16207;
                }
                
                .alert.error {
                    background-color: #fef2f2;
                    border-color: #fecaca;
                    color: #b91c1c;
                }
                
                /* Estilos para os badges das regras */
                .badge-rule {
                    display: inline-block;
                    padding: 0.25rem 0.5rem;
                    border-radius: 0.25rem;
                    font-size: 0.75rem;
                    line-height: 1rem;
                    font-weight: 500;
                    margin-right: 0.25rem;
                    margin-bottom: 0.25rem;
                }
            </style>
            
            
            <!-- Seção de Restrições -->
            {% if categoria_atual and categoria_atual.tipo == 'RESTRICAO' %}
                <fieldset class="w-full mb-8 rounded-2xl bg-red-300 p-1 border border-red-200">
                    <section class="bg-white p-4 rounded-lg shadow-md border border-red-600">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                            <i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i>
                            Restrições Aplicáveis - Bol G PM 166, de 30 de agosto de 2006
                        </h3>
                        
                        {% if restricoes_aplicaveis %}
                            <div class="space-y-4">
                                {% for restricao in restricoes_aplicaveis %}
                                    <div class="border rounded-lg overflow-hidden">
                                        <div class="bg-gray-50 px-4 py-2 border-b flex justify-between items-center">
                                            <div>
                                                <span class="font-bold">{{ restricao.sigla }}</span> - 
                                                <span>{{ restricao.nome }}</span>
                                            </div>
                                            <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                                                {{ restricao.regra }}
                                            </span>
                                        </div>
                                        <div class="p-4 bg-white">
                                            <p class="text-gray-700">{{ restricao.mensagem }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="bg-blue-50 p-4 rounded-md border border-blue-200 text-blue-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                Nenhuma restrição específica aplicada atualmente.
                            </div>
                        {% endif %}
                        
                        {% if 'UA' in restricoes_siglas %}
                            <div class="mt-4 bg-red-50 p-4 rounded-md border-l-4 border-red-500">
                                <h4 class="font-bold text-red-800 mb-2">Atenção Especial (5.2.5.1):</h4>
                                <p class="text-gray-700">
                                    A critério do respectivo Cmt, Dir ou Ch da Unidade, baseado no parecer que impôs a restrição, na observação continuada do PM, que inclusive pode ser feita por investigação sigilosa, no que se refere a seu comprometimento para desempenhar suas atividades profissionais, deverá ser instaurado processo administrativo com o fim de verificar, dentre outras questões, as condições de permanência desse policial militar no serviço ativo.
                                </p>
                            </div>
                        {% endif %}
                    </section>
                </fieldset>
            {% endif %}

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-2 mb-4 rounded-md w-full max-w-full">
                <fieldset class="bg-gray-100 rounded-2xl shadow-lg p-6 border border-gray-200 flex flex-col h-full">
                    <div class="flex-grow">
                        <div class="flex items-center justify-between mb-2">
                            <h2 class="text-xl font-semibold text-indigo-900 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m5 10v-3a3 3 0 00-3-3H5a3 3 0 00-3 3v3c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2z"/>
                                </svg>
                                Situação Funcional
                            </h2>
                        </div>

                        <a href="{% url 'efetivo:historico_movimentacoes' cadastro.id %}" class="text-xs text-gray-600 hover:text-indigo-400 transition duration-300 block mb-2">
                            Histórico de Movimentações e Promoções →
                        </a>
                        <hr class="my-4 border-gray-200">

                        <div class="bg-indigo-200 rounded-xl p-5 border border-indigo-100 shadow-sm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-5">
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Situação</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.detalhes_situacao.last.status|default:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">SGB</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.detalhes_situacao.last.sgb|default:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Posto/Seção</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.detalhes_situacao.last.posto_secao|default:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Adido ao</span>
                            
                                    <p class="text-gray-800 font-medium truncate">
                                       {{ cadastro.detalhes_situacao.last.esta_adido|default:"-" }}
                                    </p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Função</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.detalhes_situacao.last.funcao|default:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Prontidão</span>
                                    <div class="text-gray-800 font-medium">{{ cadastro.detalhes_situacao.last.prontidao_badge|default:"-" }}</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 flex justify-end">
                                <button id="openEditarSituacaoBtn" 
                                        class="inline-flex items-center px-6 py-3 bg-indigo-700 hover:bg-indigo-800 text-white font-bold rounded-lg shadow-md transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 text-base gap-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    <span>Editar Situação Funcional</span>
                                </button>


                            <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                const openEditarSituacaoBtn = document.getElementById('openEditarSituacaoBtn');
                                const editarSituacaoFuncionalModal = document.getElementById('editarSituacaoFuncionalModal');

                                if (openEditarSituacaoBtn && editarSituacaoFuncionalModal) {
                                    openEditarSituacaoBtn.addEventListener('click', function() {
                                        editarSituacaoFuncionalModal.classList.remove('hidden');
                                    });
                                }
                            });
                            </script>           
                            </div>
                            
                            {# No final da seção de situação funcional #}
                            {% include 'modals/choice_modal.html' %}
                            {% include 'modals/editar_situacao_funcional.html' %}
                            {% include 'modals/nova_situacao_funcional.html' %}  <!-- Novo modal -->
                            {# Adicione um script para armazenar os dados atuais para o JS #}
                            <script id="currentSituacaoData" type="application/json">
                                {
                                    "id": "{{ detalhe_situacao.id|default:'' }}",
                                    "situacao": "{{ detalhe_situacao.situacao|default:'' }}",
                                    "sgb": "{{ detalhe_situacao.sgb|default:'' }}",
                                    "posto_secao": "{{ detalhe_situacao.posto_secao|default:'' }}",
                                    "esta_adido": "{{ detalhe_situacao.esta_adido|default:'' }}",
                                    "funcao": "{{ detalhe_situacao.funcao|default:'' }}",
                                    "op_adm": "{{ detalhe_situacao.op_adm|default:'' }}",
                                    "prontidao": "{{ detalhe_situacao.prontidao|default:'' }}",
                                    "apresentacao_na_unidade": "{{ detalhe_situacao.apresentacao_na_unidade|date:'Y-m-d'|default:'' }}",
                                    "saida_da_unidade": "{{ detalhe_situacao.saida_da_unidade|date:'Y-m-d'|default:'' }}"
                                }
                            </script>
                        </div>
                    </div>                   
                    <div class="mt-auto pt-4">
                
                        <div class="bg-indigo-200 rounded-lg p-4 mb-4 border border-indigo-100">
                            <div class="flex flex-col space-y-3">
                
                                <div class="flex items-center justify-between gap-4 p-2 bg-white rounded-lg shadow-sm">
                                    <span class="text-indigo-700 font-medium flex items-center">
                                        <i class="fas fa-info-circle mr-2"></i> Status:
                                    </span>
                                    <span class="text-gray-800 font-semibold">
                                        {% if categoria_atual %}
                                            <span class="px-3 py-1.5 rounded-full text-sm font-semibold {{ categoria_atual.status_display.classe }} flex items-center">
                                                <i class="fas {{ categoria_atual.status_display.icone }} mr-2"></i>
                                                {{ categoria_atual.status_display.texto }}
                                            </span>
                                        {% else %}
                                            <span class="bg-green-100 text-green-800 px-3 py-1.5 rounded-full text-sm font-semibold flex items-center">
                                                <i class="fas fa-check-circle mr-2"></i>
                                                ATIVO
                                            </span>
                                        {% endif %}
                                    </span>
                                </div>
                
                                {% for categoria in cadastro.categorias_efetivo.all %}
                                    {% if categoria.ativo and categoria.tipo != 'ATIVO' %}
                                    <div class="flex flex-col p-3 bg-white rounded-lg shadow-sm">
                                        <div class="flex items-center justify-between gap-4 mb-1">
                                            <span class="text-indigo-700 font-medium flex items-center">
                                                <i class="fas fa-tag mr-2"></i> Categoria:
                                            </span>
                                            <span class="text-gray-800 font-semibold">
                                                {{ categoria.get_tipo_display }}
                                                {% if categoria.data_termino %}
                                                    <span class="text-xs text-gray-500 ml-1">
                                                        (até {{ categoria.data_termino|date:"d/m/Y" }})
                                                    </span>
                                                {% endif %}
                                            </span>
                                        </div>
                
                                        <div class="mt-2 bg-gray-50 p-2 rounded">
                                            {% if categoria.tipo == 'RESTRICAO' and categoria.restricoes_selecionadas %}
                                                <span class="text-xs font-medium text-gray-600">Restrições ativas:</span>
                                                <div class="flex flex-wrap gap-1 mt-1">
                                                    {% for restricao in categoria.restricoes_selecionadas %}
                                                    <span class="bg-gray-200 text-gray-800 px-2 py-1 rounded-full text-xs">
                                                        {{ restricao }}
                                                    </span>
                                                    {% endfor %}
                                                </div>
                                            {% elif categoria.tipo == 'LSV' %}
                                                <div class="text-xs space-y-1">
                                                    <div class="flex items-center">
                                                        <span class="font-medium text-gray-600 mr-2">Boletim:</span>
                                                        <span>{{ categoria.boletim_concessao_lsv|default:"-" }}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="font-medium text-gray-600 mr-2">Data Boletim:</span>
                                                        <span>{{ categoria.data_boletim_lsv|date:"d/m/Y"|default:"-" }}</span>
                                                    </div>
                                                </div>
                                            {% elif categoria.tipo == 'FERIAS' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Período de férias</span>
                                                </div>
                                            {% elif categoria.tipo == 'LP' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Licença Prêmio</span>
                                                </div>
                                            {% elif categoria.tipo == 'ELEIÇÃO' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Período Eleitoral</span>
                                                </div>
                                            {% elif categoria.tipo == 'CONVAL' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Convalescença</span>
                                                </div>
                                            {% elif categoria.tipo == 'LTS' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Licença para Tratamento de Saúde</span>
                                                </div>
                                            {% elif categoria.tipo == 'LTS FAMILIA' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Licença para Tratar de Assuntos Familiares</span>
                                                </div>
                                            {% elif categoria.tipo == 'DS' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Dispensa de Serviço</span>
                                                </div>
                                            {% elif categoria.tipo == 'DR' %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-gray-600">Dispensa Recompensa</span>
                                                </div>
                                            {% endif %}
                
                                            {% if categoria.observacao %}
                                                <div class="mt-2 text-xs">
                                                    <span class="font-medium text-gray-600">Observação:</span>
                                                    <p class="text-gray-700">{{ categoria.observacao }}</p>
                                                </div>
                                            {% endif %}
                                        </div>
                
                                    </div>
                                    {% endif %}
                                {% endfor %}
                
                                <div class="flex justify-end mb-8">
                                    <a href="{% url 'efetivo:historico_categorias' cadastro.id %}"
                                    class="mb-4 text-indigo-600 hover:text-indigo-800 transition duration-300 text-sm font-medium flex items-center">
                                        <span>Histórico e Edição</span>
                                        <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="mt-auto pt-4 flex flex-wrap gap-2">
                                <button type="button"
                                    class="inline-flex items-center px-6 py-3 bg-indigo-700 hover:bg-indigo-800 text-white font-bold rounded-lg shadow-md transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 text-base gap-x-2 animate-pulse"
                                    onclick="openCatEfetivoModal()"> {# CORRIGIDO AQUI: Usa onclick para chamar a função JavaScript #}
                                    <i class="fas fa-plus-circle text-lg"></i>
                                    <span>Incluir Novo Afastamento</span>
                                </button>
                            </div>
                              {% include 'modals/editar_categoria_efetivo.html' %}
                        </div>
                    </div>
                
                    <script>
                        function openEditModal(modalId) {
                            document.getElementById(modalId).classList.remove('hidden');
                        }
                
                        function closeEditModal(modalId) {
                            document.getElementById(modalId).classList.add('hidden');
                        }
                    </script>
                    <script>
                        // This script seems to be for fetching and injecting modal content.
                        // I've kept it as is, assuming it works with your 'editar_categoria_efetivo.html' modal.
                        function openEditModal(categoriaId) {
                            fetch(`/efetivo/categoria/editar/${categoriaId}/`, {
                                headers: { 'X-Requested-With': 'XMLHttpRequest' }
                            })
                            .then(response => response.text())
                            .then(html => {
                                const div = document.createElement('div');
                                div.innerHTML = html;
                                document.body.appendChild(div);
                            });
                        }
                    </script>

                </fieldset>
                <!-- Documentos e Contatos -->
                <fieldset class="bg-gray-100 rounded-2xl shadow-lg p-6 border border-gray-200 flex flex-col h-full">
                    {% if not cadastro %}
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert">
                        <p>Erro ao carregar dados do militar.</p>
                    </div>
                    {% else %}
                    <div class="flex-grow">
                        <div class="flex items-center justify-between mb-2">
                            <h2 class="text-xl font-semibold text-indigo-900 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                Documentos e Contatos
                            </h2>
                        </div>
                        
                        <hr class="my-4 border-gray-200">
                        
                        <div class="bg-indigo-200 rounded-xl p-5 border border-indigo-100 shadow-sm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-5">
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Nome Completo</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.nome|default_if_none:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Nome de Guerra</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.nome_de_guerra|default_if_none:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">RE</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.re|default_if_none:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Dig</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.dig|default_if_none:"-" }}</p>
                                </div>

                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">CPF</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.cpf|default_if_none:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">RG</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.rg|default_if_none:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">E-mail</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.email|default_if_none:"-" }}</p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Telefone</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.telefone|default_if_none:"-" }}</p>
                                </div>
          

                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Sexo</span>
                                    <p class="text-gray-800 font-medium truncate">{{ cadastro.genero|default_if_none:"-" }}</p>
                                </div>

                                                              
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Posto/Graduação</span>
                                    <p class="text-gray-800 font-medium">
                                        {{ promocao.get_posto_grad_display|default:"-" }}
                                    </p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Quadro</span>
                                    <p class="text-gray-800 font-medium">
                                        {{ promocao.get_quadro_display|default:"-" }}
                                    </p>
                                </div>
                                
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Grupo</span>
                                    <p class="text-gray-800 font-medium">
                                        {{ promocao.get_grupo_display|default:"-" }}
                                    </p>
                                </div>
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Averbação Militar:</span>
                                    <p class="text-gray-800 font-medium">
                                          {{ cadastro.tempo_para_averbar_militar|default_if_none:"0" }} dias
                                    </p>
                                </div>
                                <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-xs">
                                    <span class="block text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">Averbação INSS:
                                    </span></span>
                                    <p class="text-gray-800 font-medium">
                                    {{ cadastro.tempo_para_averbar_inss|default_if_none:"0" }} dias
                                    </p>
                                </div>


                            </div>
                            
                        <button type="button"
                                data-modal-open="editarDadosPessoaisModal"
                                class="flex items-center justify-center px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            Editar Documentos e Contatos
                        </button>


                        {% include 'modals/editar_dados_pessoais.html' %}
                        </div>
                    </div>

                    {% endif %}
                </fieldset>
            </div>

            <fieldset class="w-full mb-8 rounded-2xl bg-gray-100 p-2 border border-gray-200">
                <div class="flex flex-col h-full">
                    <!-- Cabeçalho -->
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-indigo-900 mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Histórico Temporal Completo
                        </h2>
                    </div>
            
                    <!-- Conteúdo Principal -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-grow">
                        <!-- Cartão 1: Dados Pessoais e Temporais -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-indigo-900">
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full mr-2">DP</span>
                                    Dados Pessoais
                                </h3>
                                <span class="text-xs font-medium px-2 py-1 rounded 
                                    {% if cadastro.ativo %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                    {% if cadastro.ativo %}Ativo{% else %}Inativo{% endif %}
                                </span>
                            </div>
                            <hr class="my-4 border-gray-200">
                            
                            <!-- Linha 1: Nascimento -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    <span>Nascimento</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ cadastro.nasc|date:"d/m/Y" }}</p>
                                    <p class="text-sm text-blue-600">{{ cadastro.idade_detalhada }}</p>
                                </div>
                            </div>
                            
                            <!-- Linha 2: Matrícula -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <span>Matrícula</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ cadastro.matricula|date:"d/m/Y" }}</p>
                                    <p class="text-sm text-blue-600">{{ cadastro.matricula_detalhada }}</p>
                                </div>
                            </div>
                            
                            <!-- Linha 3: Admissão -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                                    </svg>
                                    <span>Admissão</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ cadastro.admissao|date:"d/m/Y" }}</p>
                                    <p class="text-sm text-blue-600">{{ cadastro.admissao_detalhada }}</p>
                                </div>
                            </div>
                            
                            <!-- Linha 4: Previsão Inatividade -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>Previsão Inatividade</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ cadastro.previsao_de_inatividade|date:"d/m/Y" }}</p>
                                    <p class="text-sm text-blue-600">{{ cadastro.previsao_de_inatividade_detalhada }}</p>
                                </div>
                            </div>
                        </div>
            
                        <!-- Cartão 2: Progressão e Unidade -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-indigo-900">
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full mr-2">PU</span>
                                    Progressão e Unidade
                                </h3>
                                <span class="text-xs font-medium px-2 py-1 rounded bg-indigo-100 text-indigo-800">
                                    {{ cadastro.posto_graduacao }}
                                </span>
                            </div>
                            <hr class="my-4 border-gray-200">
                            
                            <!-- Linha 1: Última Promoção -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                    </svg>
                                    <span>Última Promoção</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ promocao.ultima_promocao|date:"d/m/Y" }}</p>
                                    <p class="text-sm text-indigo-600">{{ promocao.ultima_promocao_detalhada }}</p>
                                </div>
                            </div>
                            
                            <!-- Linha 2: Unidade -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                    </svg>
                                    <span>Unidade</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ cadastro.unidade }}</p>
                                    <p class="text-sm text-indigo-600">{{ cadastro.funcao }}</p>
                                </div>
                            </div>
                            
                            <!-- Linha 3: Apresentação na Unidade -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    <span>Apresentação</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">{{ cadastro.detalhes_situacao.last.apresentacao_na_unidade|date:"d/m/Y" }}</p>
                                    <p class="text-sm text-indigo-600">
                                        {% if cadastro.detalhes_situacao.last.saida_da_unidade %}
                                            {{ cadastro.tempo_na_unidade_detalhada }}
                                        {% else %}
                                            Ativo na unidade
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Linha 4: Saída da Unidade -->
                            <div class="flex items-center justify-between py-2">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    <span>Saída da Unidade</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800">
                                        {% if cadastro.detalhes_situacao.last.saida_da_unidade %}
                                            {{ cadastro.detalhes_situacao.last.saida_da_unidade|date:"d/m/Y" }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        
            <fieldset class="w-full mb-8 rounded-2xl bg-gray-100 p-2 border border-gray-200">
                <div class="flex flex-col h-full">
                    <!-- Cabeçalho -->
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-indigo-900 mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Benefícios de Tempo de Serviço
                        </h2>
                        <a href="{% url 'efetivo:historico_movimentacoes' cadastro.id %}" class="ms-8 text-sm text-gray-600 hover:text-indigo-800 transition duration-300">
                            Histórico de Adicional e LP →
                        </a>
                    </div>
            
                    <!-- Conteúdo Principal -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-grow">
                        <!-- Adicional de Tempo de Serviço -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-indigo-900">
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full mr-2">ATS</span>
                                    Adicional de Tempo de Serviço
                                </h3>
                                {% if adicional %}
                                <span class="text-xs font-medium px-2 py-1 rounded 
                                    {% if adicional.situacao_adicional == 'Concluído' %}bg-green-100 text-green-800
                                    {% elif adicional.situacao_adicional == 'Concedido' %}bg-blue-100 text-blue-800
                                    {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                    {{ adicional.get_situacao_adicional_display }}
                                </span>
                                {% endif %}
                            </div>
                            <hr class="my-4 border-gray-200">
                            
                            {% with adicional=cadastro.cadastro_adicional_set.last %}
                            {% if adicional %}
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Coluna 1 - Informações Básicas -->
                                <div class="space-y-3">
                                    <div class="flex items-start gap-3">
                                        <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                        <div>
                                            <p class="text-sm text-gray-500">Bloco Atual</p>
                                            <p class="font-medium text-gray-800">{{ adicional.numero_adicional }}º Bloco</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start gap-3">
                                        <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        <div>
                                            <p class="text-sm text-gray-500">Data da Concessão</p>
                                            <p class="font-medium text-gray-800">
                                                {% if adicional.data_concessao_adicional %}
                                                    {{ adicional.data_concessao_adicional|date:"d/m/Y" }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start gap-3">
                                        <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                        <div>
                                            <p class="text-sm text-gray-500">Bol G PM</p>
                                            <p class="font-medium text-gray-800">
                                                {% if adicional.bol_g_pm_adicional %}
                                                    {{ adicional.bol_g_pm_adicional }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Coluna 2 - Status e Detalhes -->
                                <div class="space-y-3">
                                    <div class="flex items-start gap-3">
                                        <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                        </svg>
                                        <div>
                                            <p class="text-sm text-gray-500">Status</p>
                                            <p class="font-medium text-gray-800">
                                                {{ adicional.get_status_adicional_display }}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start gap-3">
                                        <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        <div>
                                            <p class="text-sm text-gray-500">Data de Publicação</p>
                                            <p class="font-medium text-gray-800">
                                                {% if adicional.data_publicacao_adicional %}
                                                    {{ adicional.data_publicacao_adicional|date:"d/m/Y" }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start gap-3">
                                        <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        <div>
                                            <p class="text-sm text-gray-500">6ª Parte </p>
                                            <p class="font-medium text-gray-800">
                                                {% if adicional.sexta_parte %}
                                                    <span class="text-green-600">Sim</span>
                                                {% else %}
                                                    <span class="text-gray-500">Não</span>
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Seção de Detalhes Adicionais -->
                            <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-gray-700 mb-2">Detalhes do Processo</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-500">Data do Último Adicional</p>
                                        <p class="font-medium">{{ adicional.data_ultimo_adicional|date:"d/m/Y" }}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">Próximo Bloco</p>
                                        <p class="font-medium">{{ adicional.numero_prox_adicional }}º Bloco</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Previsão Próximo</p>
                                        <p class="font-medium text-gray-800">
                                            {% if adicional.proximo_adicional_calculado %}
                                                {{ adicional.proximo_adicional_calculado|date:"d/m/Y" }}
                                                {% if adicional.dias_desconto_adicional > 0 %}
                                                    <span class="text-xs text-red-500 ml-1">
                                                        ({{ adicional.dias_desconto_adicional }} dia{{ adicional.dias_desconto_adicional|pluralize }} de desconto)
                                                    </span>
                                                {% endif %}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </p>
                                        {% if adicional.data_concessao_adicional %}
                                        <p class="mt-1 text-xs text-gray-400">
                                            Base: {{ adicional.data_concessao_adicional|date:"d/m/Y" }} + 5 anos
                                            {% if adicional.dias_desconto_adicional > 0 %}
                                                - {{ adicional.dias_desconto_adicional }} dia{{ adicional.dias_desconto_adicional|pluralize }}
                                            {% endif %}
                                        </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="text-center py-6">
                                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <h4 class="mt-2 text-sm font-medium text-gray-700">Nenhum adicional registrado</h4>
                                <p class="mt-1 text-sm text-gray-500">Este militar ainda não possui adicionais cadastrados no sistema.</p>
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                                    
                        <!-- Licença-Prêmio -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold text-indigo-900 mb-4">
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full mr-2">LP</span>
                                Licença-Prêmio
                            </h3>
                            <hr class="my-4 border-gray-200">
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-gray-600 font-medium">Bloco Atual:</span>
                                    <span class="text-gray-800 font-semibold">{{ cadastro.cadastro_adicional.numero_lp }}</span>
                                </div>
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-gray-600 font-medium">Concessão:</span>
                                    <span class="text-gray-800 font-semibold">{{ cadastro.cadastro_adicional.data_ultimo_lp }}</span>
                                </div>
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-gray-600 font-medium">Próximo Bloco:</span>
                                    <span class="text-gray-800 font-semibold">{{ cadastro.cadastro_adicional.numero_prox_lp }}</span>
                                </div>
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-gray-600 font-medium">Previsão:</span>
                                    <span class="text-gray-800 font-semibold">{{ cadastro.cadastro_adicional.proximo_lp }}</span>
                                </div>
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-gray-600 font-medium">Status:</span>
                                    <span class="text-gray-800 font-semibold">{{ cadastro.cadastro_adicional.status_lp }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        
            <fieldset class="w-full mb-8 rounded-2xl bg-gray-100 p-2 border border-gray-200">
                <div class="flex flex-col h-full">
                    <!-- Cabeçalho -->
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-indigo-900 mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13.5m0-13.5c-3.175 0-5.75 2.15-5.75 4.875 0 2.725 2.575 4.875 5.75 4.875s5.75-2.15 5.75-4.875c0-2.725-2.575-4.875-5.75-4.875zM12 6.253a6 6 0 00-6 6v.5"/>
                            </svg>
                            Condecorações e Qualificações
                        </h2>
                        <a href="#" class="ms-8 text-sm text-gray-600 hover:text-indigo-800 transition duration-300">
                            Histórico Completo →
                        </a>
                    </div>

                    <!-- Conteúdo Principal -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-grow">
                        <!-- Medalhas -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-indigo-900">
                                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full mr-2">MD</span>
                                    Medalhas e Condecorações
                                </h3>
                            </div>
                            <hr class="my-4 border-gray-200">
                            
                            {% if medalhas_do_militar %}
                                <ul class="space-y-3">
                                    {% for medalha in medalhas_do_militar %}
                                        <li class="flex justify-between items-center bg-gray-50 p-3 rounded-md hover:bg-gray-100 transition-colors">
                                            <div class="flex items-center gap-3">
                                                <svg class="flex-shrink-0 w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                                </svg>
                                                <span class="text-gray-800 font-medium">{{ medalha.get_honraria_display }}</span>
                                            </div>
                                            <span class="text-sm text-gray-600">{{ medalha.data_publicacao|date:"d/m/Y" }}</span>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <div class="text-center py-6">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <h4 class="mt-2 text-sm font-medium text-gray-700">Nenhuma medalha registrada</h4>
                                    <p class="mt-1 text-sm text-gray-500">Este militar ainda não possui condecorações cadastradas.</p>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Cursos -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-indigo-900">
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full mr-2">CR</span>
                                    Cursos e Qualificações
                                </h3>
                            </div>
                            <hr class="my-4 border-gray-200">
                            
                            {% if cursos_do_militar %}
                                <ul class="space-y-3">
                                    {% for curso in cursos_do_militar %}
                                        <li class="flex justify-between items-center bg-gray-50 p-3 rounded-md hover:bg-gray-100 transition-colors">
                                            <div class="flex items-center gap-3">
                                                <svg class="flex-shrink-0 w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                                </svg>
                                                <span class="text-gray-800 font-medium">{{ curso.get_curso_display }}</span>
                                            </div>
                                            <span class="text-sm text-gray-600">{{ curso.data_publicacao|date:"d/m/Y" }}</span>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <div class="text-center py-6">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <h4 class="mt-2 text-sm font-medium text-gray-700">Nenhum curso registrado</h4>
                                    <p class="mt-1 text-sm text-gray-500">Este militar ainda não possui qualificações cadastradas.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </fieldset>


            <fieldset class="w-full mb-8 rounded-2xl bg-gray-100 p-2 border border-gray-200">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="flex flex-col h-full">
                    <!-- Cabeçalho -->
                    <div class="mb-6">
                    </div>
            <!-- Seção RPT-Interno -->

                    <!-- Cabeçalho -->
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-indigo-900 mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            RPT-Interno
                        </h2>

                    </div>

                    <!-- Conteúdo Principal -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-indigo-900">
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full mr-2">RPT</span>
                                Pedido Ativo
                            </h3>
                            {% if cadastro_rpt %}
                            <span class="text-xs font-medium px-2 py-1 rounded 
                                {% if cadastro_rpt.status == 'Aguardando' %}bg-yellow-100 text-yellow-800
                                {% elif cadastro_rpt.status == 'Mov. serviço' %}bg-green-100 text-green-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ cadastro_rpt.get_status_display }}
                            </span>
                            {% endif %}
                        </div>
                        <hr class="my-4 border-gray-200">
                        
                        {% if cadastro_rpt %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Coluna 1 -->
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                                <div>
                                        <p class="text-sm text-gray-500 mb-1">  <!-- Adicionei mb-1 para espaçamento -->
                                            <svg class="inline-flex w-4 h-4 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                            </svg>
                                            Status
                                        </p>
                                        <p class="text-sm font-medium text-gray-800 ml-6">{{ cadastro_rpt.pedido_status }}</p>  <!-- Reduzi o texto e adicionei ml-6 -->
                                    </div>
                                </div>
                                
                                <div class="flex items-start gap-3">
                                    <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    <div>
                                        <p class="text-sm text-gray-500">Data do Pedido</p>
                                        <p class="font-medium text-gray-800">{{ cadastro_rpt.data_pedido|date:"d/m/Y" }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Coluna 2 -->
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    <div>
                                        <p class="text-sm text-gray-500">Destino Solicitado</p>
                                        <p class="font-medium text-gray-800">
                                            {{ cadastro_rpt.sgb_destino }} - {{ cadastro_rpt.posto_secao_destino }}
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start gap-3">
                                    <svg class="flex-shrink-0 w-5 h-5 text-indigo-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <div>
                                        <p class="text-sm text-gray-500">Tempo de Espera</p>
                                        <p class="font-medium text-gray-800">{{ cadastro_rpt.tempo_pedido_detalhada }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção Adicional -->
                        <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-500">Documento de Solicitação</p>
                                    <p class="font-medium">{{ cadastro_rpt.doc_solicitacao|default:"-" }}</p>
                                </div>
                                <div>
                                    <p class="text-gray-500">Posição na Fila</p>
                                    <p class="font-medium">
                                        {{ count_in_section|default:"N/A" }}
                                        <span class="text-xs text-gray-500">({{ count_in_section|default:"0" }} na mesma seção)</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="text-center py-6">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <h4 class="mt-2 text-sm font-medium text-gray-700">Nenhum RPT registrado</h4>
                            <p class="mt-1 text-sm text-gray-500">Este militar não possui pedidos de RPT-Interno ativos</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
          
            </fieldset>
        
            <fieldset class="p-4 mb-8 rounded-2xl bg-gray-100 border border-gray-200 w-full">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <!-- Texto do Sistema -->
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium text-center md:text-left">
                            Sistema de Gestão de Militares
                        </p>
                    </div>
            
                    <!-- Container de Botões -->
                    <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                        <!-- Botão Voltar -->
                        <a href="{% if request.GET.from == 'list' %}{% url 'efetivo:listar_militar' %}{% else %}{% url 'efetivo:lista_militares' %}{% endif %}" 
                        class="flex-1 px-6 py-3.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white 
                               font-semibold rounded-xl shadow-sm hover:shadow-md
                               transition-all duration-200 hover:scale-[1.02]
                               flex items-center justify-center gap-2">
                         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                         </svg>
                         Voltar
                     </a>
            
                        <!-- Botão Excluir -->
                        <button type="button" onclick="openDeleteModal()"
                                class="flex-1 px-6 py-3.5 bg-gradient-to-r from-red-500 to-red-400 text-white 
                                    font-semibold rounded-xl shadow-sm hover:shadow-md
                                    transition-all duration-200 hover:scale-[1.02]
                                    flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            Excluir
                        </button>
                    </div>
                </div>
            
                <!-- Modal de Exclusão -->
                <div id="exampleModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
                    <div class="bg-gray-100 rounded-xl shadow-xl w-full max-w-md">
                        <form method="POST" action="{% url 'efetivo:excluir_militar' cadastro.id %}">
                            {% csrf_token %}
                            <!-- Cabeçalho do Modal -->
                            <div class="flex justify-between items-center p-6 bg-gray-800 rounded-t-xl">
                                <h2 class="text-xl font-semibold text-gray-100">Confirmar Exclusão</h2>
                                <button type="button" onclick="closeDeleteModal()" class="text-gray-400 hover:text-gray-200 text-2xl">&times;</button>
                            </div>
            
                            <!-- Corpo do Modal -->
                            <div class="p-6 space-y-4">
                                <p class="text-gray-700">Você está prestes a excluir o militar:</p>
                                <p class="text-red-600 font-bold">{{ cadastro.nome }}</p>
            
                                <div class="space-y-2">
                                    <label for="password" class="block text-sm font-medium text-gray-700">Digite sua senha:</label>
                                    <input type="password" 
                                        name="password" 
                                        id="passwordInput"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                                        required>
                                    <div id="passwordError" class="text-red-500 text-sm hidden"></div>
                                </div>
                            </div>
            
                            <!-- Rodapé do Modal -->
                            <div class="flex justify-end gap-4 p-6 bg-gray-50 rounded-b-xl">
                                <button type="button" onclick="closeDeleteModal()" 
                                        class="px-6 py-2 text-gray-700 hover:text-gray-900 transition-colors">
                                    Cancelar
                                </button>
                                <button type="submit" 
                                        class="px-6 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg
                                            hover:shadow-md transition-all duration-200">
                                    Confirmar Exclusão
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </fieldset>
        </fieldset>
    </div>
    
  
    <script src="{% static 'efetivo/js/situacao_funcional.js' %}"></script>
    <script>
        /**
         * CONTROLE GERAL DE MODAIS
         * ----------------------------------------------------------
         * Este script unificado gerencia todas as interações com modais,
         * validações de formulário e submissões AJAX na página.
         */
    
        // ==========================================================
        // 1. FUNÇÕES DE CONTROLE DE MODAIS
        // ==========================================================
    
    
    /**
     * SISTEMA COMPLETO DE CONTROLE DE MODAIS
     * ----------------------------------------------------------
     * 1. Controle centralizado de todos os modais
     * 2. Preview de imagem integrado
     * 3. Validação de formulário
     * 4. Fluxo de confirmação
     */

    document.addEventListener('DOMContentLoaded', () => {
        // Estados do sistema
        let currentActiveModal = null;

        // Funções principais
        const modalActions = {
            open: (modalId) => {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                modal.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
                currentActiveModal = modal;
            },

            close: (modalId) => {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                modal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
                currentActiveModal = null;
            }
        };

        // Event Delegation para todos os cliques
        document.body.addEventListener('click', (e) => {
            // Abrir modais
            if (e.target.closest('[data-modal-open]')) {
                const target = e.target.closest('[data-modal-open]').dataset.modalOpen;
                modalActions.open(target);
            }

            // Fechar modais
            if (e.target.closest('[data-modal-close]')) {
                const modal = e.target.closest('.fixed');
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                }
            }
        });

        // Preview de Imagem
        const handleImagePreview = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            const preview = document.getElementById('preview');
            const icon = preview.previousElementSibling;

            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                icon.classList.add('hidden');
            };

            reader.readAsDataURL(file);
        };

        // Configurar eventos específicos
        const imageInput = document.querySelector('#trocaFotoModal input[type="file"]');
        if (imageInput) {
            imageInput.addEventListener('change', handleImagePreview);
        }

        // Configurar submit do formulário de edição
        const confirmSave = document.getElementById('confirmSave');
        if (confirmSave) {
            confirmSave.addEventListener('click', () => {
                const form = document.getElementById('editForm');
                if (form.reportValidity()) {
                    form.submit();
                    modalActions.close('confirmModal');
                }
            });
        }

        // Configurar submit do formulário de dados pessoais
        const confirmSave1 = document.getElementById('confirmSave1');
        if (confirmSave1) {
            confirmSave1.addEventListener('click', () => {
                const form = document.getElementById('editForm1');
                if (form.reportValidity()) {
                    form.submit();
                    modalActions.close('confirmModal-geral');
                }
            });
        }

        // Fechar modais com ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && currentActiveModal) {
                currentActiveModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        // Função para abrir modais
        const openModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
            }
        };

        // Função para fechar modais
        const closeModal = (modal) => {
            modal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        };

        // Event Delegation para controle de modais
        document.body.addEventListener('click', (e) => {
            // Abrir modal
            if (e.target.closest('[data-modal-open]')) {
                const modalId = e.target.closest('[data-modal-open]').dataset.modalOpen;
                openModal(modalId);
            }

            // Fechar modal
            if (e.target.closest('[data-modal-close]')) {
                const modal = e.target.closest('.fixed');
                closeModal(modal);
            }
        });

        // Fechar com tecla ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.fixed.hidden');
                modals.forEach(modal => closeModal(modal));
            }
        });
    });


        // ==========================================================
        // 2. FUNÇÕES DE VALIDAÇÃO E SUBMISSÃO DE FORMULÁRIOS
        // ==========================================================
    
        /**
         * Validação de preview de imagem para upload
         * @param {Event} event - Evento de mudança no input de arquivo
         */
        const previewImage = (event) => {
            const reader = new FileReader();
            const preview = document.getElementById('preview');
            const icon = preview.parentElement.querySelector('svg');
    
            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                icon?.classList.add('hidden');
            };
            reader.readAsDataURL(event.target.files[0]);
        };
    
        /**
         * Manipulação do formulário de situação funcional
         */
        const handleSituacaoForm = async (event) => {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
    
            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData
                });
    
                if (response.ok) {
                    openModal(document.getElementById('choiceModal'));
                } else {
                    alert('Erro ao salvar alterações');
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                alert('Erro de comunicação com o servidor');
            }
        };
    
        // ==========================================================
        // 3. CONFIGURAÇÃO DE EVENT LISTENERS
        // ==========================================================
    
        document.addEventListener('DOMContentLoaded', () => {
            // Controle genérico de modais
            document.querySelectorAll('[data-modal-target]').forEach(button => {
                button.addEventListener('click', () => {
                    const target = button.dataset.modalTarget;
                    openModal(document.querySelector(target));
                });
            });
    
            document.querySelectorAll('[data-modal-close]').forEach(button => {
                button.addEventListener('click', () => {
                    closeModal(button.closest('.fixed'));
                });
            });
    
            // Preview de imagem no upload
            document.getElementById('image')?.addEventListener('change', previewImage);
    
            // Manipulação do formulário de situação funcional
            const editSituacaoForm = document.getElementById('editSituacaoForm');
            if (editSituacaoForm) {
                editSituacaoForm.addEventListener('submit', handleSituacaoForm);
            }
    
            // Controle do modal de confirmação
            document.getElementById('confirmSave1')?.addEventListener('click', () => {
                document.getElementById('editForm1').submit();
                closeModal(document.getElementById('confirmModal-geral'));
            });
        });
    
        // ==========================================================
        // 4. FUNÇÕES DE CONTROLE DE FLUXO
        // ==========================================================
    
        /**
         * Exibe modal de confirmação para alterações críticas
         */
        window.showConfirmation = () => {
            openModal(document.getElementById('confirmModal'));
        };
    
        /**
         * Fecha modal de confirmação
         */
        window.closeConfirmation = () => {
            closeModal(document.getElementById('confirmModal'));
        };
    
        /**
         * Submete formulário principal após confirmação
         */
        window.submitForm = () => {
            document.getElementById('editForm').submit();
            closeConfirmation();
        };
    </script>

    
            <script>
                function validatePassword() {
                    const password = document.getElementById('password').value;
                    const correctPassword = 'suaSenhaAqui'; // Substitua por sua lógica de verificação de senha
            
                    if (password === correctPassword) {
                        window.location.href = "{% url 'efetivo:excluir_militar' cadastro.id %}";
                    } else {
                        alert('Senha incorreta. Tente novamente.');
                    }
                }
            
                document.querySelectorAll('[data-modal-target]').forEach(button => {
                    button.addEventListener('click', () => {
                        const modal = document.querySelector(button.getAttribute('data-modal-target'));
                        modal.classList.remove('hidden');
                    });
                });
            
                document.querySelectorAll('[data-modal-close]').forEach(button => {
                    button.addEventListener('click', () => {
                        const modal = document.querySelector(button.getAttribute('data-modal-close'));
                        modal.classList.add('hidden');
                    });
                });
            </script>
            
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const openModalButtons = document.querySelectorAll('[data-modal-target]');
                    const closeModalButtons = document.querySelectorAll('[data-modal-close]');
        
                    openModalButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const modal = document.querySelector(button.dataset.modalTarget);
                            openModal(modal);
                        });
                    });
        
                    closeModalButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const modal = button.closest('.fixed');
                            closeModal(modal);
                        });
                    });
        
                    function openModal(modal) {
                        if (modal == null) return;
                        modal.classList.remove('hidden');
                    }
        
                    function closeModal(modal) {
                        if (modal == null) return;
                        modal.classList.add('hidden');
                    }
                });
            </script>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const openModalButtons = document.querySelectorAll('[data-modal-target]');
                    const closeModalButtons = document.querySelectorAll('[data-modal-close]');
            
                    openModalButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const modal = document.querySelector(button.dataset.modalTarget);
                            openModal(modal);
                        });
                    });
            
                    closeModalButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const modal = button.closest('.fixed');
                            closeModal(modal);
                        });
                    });
            
                    function openModal(modal) {
                        if (modal == null) return;
                        modal.classList.remove('hidden');
                    }
            
                    function closeModal(modal) {
                        if (modal == null) return;
                        modal.classList.add('hidden');
                    }
                });
            </script>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const openModalButtons = document.querySelectorAll('[data-modal-target]');
                const closeModalButtons = document.querySelectorAll('[data-modal-close]');
                
                openModalButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const modal = document.querySelector(button.dataset.modalTarget);
                        openModal(modal);
                    });
                });
                
                closeModalButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const modal = button.closest('.fixed');
                        closeModal(modal);
                    });
                });
                
                function openModal(modal) {
                    if (modal == null) return;
                    modal.classList.remove('hidden');
                }
                
                function closeModal(modal) {
                    if (modal == null) return;
                    modal.classList.add('hidden');
                }
                
                const editSituacaoForm = document.getElementById('editSituacaoForm');
                editSituacaoForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const formData = new FormData(editSituacaoForm);
                    fetch(editSituacaoForm.action, {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const choiceModal = document.getElementById('choiceModal');
                            openModal(choiceModal);
                        } else {
                            alert('Erro ao salvar a situação atual.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                        alert('Erro ao salvar a situação atual.');
                    });
                });
                
                const newSituacaoForm = document.getElementById('newSituacaoForm');
                newSituacaoForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    newSituacaoForm.submit();
                });
            });


        </script>
            
    <script src="{% static 'efetivo/js/ver_militar.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
</body>

{% endblock  %}