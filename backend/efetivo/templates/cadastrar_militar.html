{% extends "base.html" %}
{% load static %}
{% block title %}Cadastrar Militares{% endblock %}

<style>
    .input-readonly {
        @apply w-full px-4 py-3 rounded-lg border border-gray-200 bg-gray-50 text-gray-700 font-medium 
               cursor-default transition-colors duration-200 hover:border-gray-300;
    }
    .optional-field {
        @apply border-gray-300 bg-white/90;
    }
    .optional-field:focus {
        @apply border-indigo-500 ring-indigo-200;
    }
</style>

{% block 'body' %}
<body>
    <div class="md:items-center md:justify-between rounded-lg mt-4 w-full" id="cad_efetivo">
    
    <fieldset class="p-4 mb-4 rounded-md w-full" id="second-fieldset">
        <fieldset class="bg-gray-800 rounded-md shadow-lg mb-2 border-0">
            <div class="p-4">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <!-- Título -->
                    <div class="flex-1 min-w-[200px]">
                        <h1 class="text-3xl font-bold text-gray-200 tracking-tight drop-shadow-md">Cadastrar Novo Militar</h1>
                    </div>
                    
                    <!-- Botões -->
                    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                        <button type="reset" class="text-white bg-gradient-to-r from-red-400 via-red-500 to-red-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-red-300 shadow-lg shadow-red-500/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all duration-200 ease-out">
                            Limpar
                        </button>
                        <a href="{% url 'efetivo:listar_militar' %}" class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 shadow-lg shadow-blue-500/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all duration-200 ease-out">
                            Voltar
                        </a>
                    </div>
                </div>
            </div>
        </fieldset>
        
        <!-- Mensagens -->
            <fieldset class="rounded-md">
                {% if messages %}
                    <div id="django-messages" style="display:none;" data-messages='[
                        {% for message in messages %}
                            {
                                "tags": "{{ message.tags|upper }}",
                                "message": "{{ message|escapejs }}"
                            }{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ]'></div>
                {% endif %}
                    {% include 'modals/alert_modal.html' %}
            </fieldset>
            
        
        <form id="militarForm" class="needs-validation" novalidate action="{% url 'efetivo:cadastrar_militar' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Seção 1: Dados de Posto e Graduação -->
            <fieldset class="border bg-gray-100 border-gray-200 p-6 mb-8 rounded-2xl shadow-sm">
                <div class="space-y-6">
                    <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Dados de Posto e Graduação</h2>
                    <hr class="border-t border-gray-100">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Posto/Grad -->
                        <div class="space-y-2">
                            <label for="posto_grad" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Posto/Grad *</label>
                            <div class="relative">
                                <select name="posto_grad" id="posto_grad" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in posto_grad %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quadro -->
                        <div class="space-y-2">
                            <label for="quadro" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Quadro *</label>
                            <div class="relative">
                                <select name="quadro" id="quadro" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in quadro %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Grupo -->
                        <div class="space-y-2">
                            <label for="grupo" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Grupo *</label>
                            <div class="relative">
                                <select name="grupo" id="grupo" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in grupo %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- RE -->
                        <div class="space-y-2">
                            <label for="re" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">RE *</label>
                            <input type="text" name="re" id="re" placeholder="Digite o RE" required
                                   class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                          shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                          transition-all duration-200 placeholder-gray-400
                                          hover:border-gray-300 text-gray-700 font-medium">
                        </div>
                        
                        <!-- Dígito -->
                        <div class="space-y-2">
                            <label for="dig" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Dig *</label>
                            <input type="text" name="dig" id="dig" placeholder="Digite o Dígito" required
                                   class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                          shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                          transition-all duration-200 placeholder-gray-400
                                          hover:border-gray-300 text-gray-700 font-medium">
                        </div>
                        
                        <!-- Gênero -->
                        <div class="space-y-2">
                            <label for="genero" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Gênero *</label>
                            <div class="relative">
                                <select name="genero" id="genero" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in genero %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Nome Completo -->
                        <div class="space-y-2 md:col-span-2">
                            <label for="nome" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Nome Completo *</label>
                            <input type="text" name="nome" id="nome" placeholder="Digite o nome completo" required
                                   class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                          shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                          transition-all duration-200 placeholder-gray-400
                                          hover:border-gray-300 text-gray-700 font-medium">
                        </div>
                        
                        <!-- Nome de Guerra -->
                        <div class="space-y-2">
                            <label for="nome_de_guerra" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Nome de Guerra *</label>
                            <input type="text" name="nome_de_guerra" id="nome_de_guerra" placeholder="Digite o nome de guerra" required
                                   class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                          shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                          transition-all duration-200 placeholder-gray-400
                                          hover:border-gray-300 text-gray-700 font-medium">
                        </div>
                    </div>
                </div>
            </fieldset>
            
            <!-- Seção 2: Situação Funcional -->
<fieldset class="border bg-gray-100 border-gray-200 p-6 mb-8 rounded-2xl shadow-sm">
    <div class="space-y-6">
        <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Situação Funcional</h2>
        <hr class="border-t border-gray-100">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Situação -->
            <div class="space-y-2">
                <label for="situacao" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Situação *</label>
                <div class="relative">
                    <select name="situacao" id="situacao" required
                            class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                   shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                   transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                   appearance-none">
                        {% for i in situacao %}
                        <option value="{{ i.0 }}" {% if i.1 == "Efetivo" %}selected{% endif %}>{{ i.1 }}</option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                        </svg>
                    </div>
                </div>
            </div>

           
                        <!-- SGB -->
                        <div class="space-y-2">
                            <label for="sgb" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">SGB *</label>
                            <div class="relative">
                                <select name="sgb" id="sgb" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                            shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                            transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                            appearance-none">
                                    {% for i in sgb %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <!-- Posto/Seção -->
                        <div class="space-y-2">
                            <label for="posto_secao" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Posto/Seção *</label>
                            <div class="relative">
                                <select name="posto_secao" id="posto_secao" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in posto_secao %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Está Adido -->
                        <div class="space-y-2">
                            <label for="esta_adido" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Está Adido? *</label>
                            <div class="relative">
                                <select name="esta_adido" id="esta_adido" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in esta_adido %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Função -->
                        <div class="space-y-2">
                            <label for="funcao" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Função *</label>
                            <div class="relative">
                                <select name="funcao" id="funcao" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in funcao %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Operacional/Administrativo -->
                        <div class="space-y-2">
                            <label for="op_adm" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Operacional/Adm *</label>
                            <div class="relative">
                                <select name="op_adm" id="op_adm" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in op_adm %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Prontidão -->
                        <div class="space-y-2">
                            <label for="prontidao" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Prontidão *</label>
                            <div class="relative">
                                <select name="prontidao" id="prontidao" required
                                        class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                               shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                               transition-all duration-200 hover:border-gray-300 text-gray-700 font-medium
                                               appearance-none">
                                    {% for i in prontidao %}
                                    <option value="{{ i.0 }}">{{ i.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data de Apresentação -->
                        <div class="space-y-2">
                            <label for="apresentacao_na_unidade" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Data Apresentação *</label>
                            <div class="relative">
                                <input type="date" name="apresentacao_na_unidade" id="apresentacao_na_unidade" required
                                       class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                              transition-all duration-200
                                              hover:border-gray-300 text-gray-700 font-medium
                                              [&::-webkit-calendar-picker-indicator]:opacity-0
                                              bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0NzQ3NDciIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjN2NE0xNSA3VjN2NE0zIDVoMTZjMCAxLjg4NiAwIDIuODI4LjU4NiAzLjQxNEMyMC4xNzIgOSAyMS4xNCA5IDIzIDl2OWMwIDEuODg2IDAgMi44MjgtLjU4NiAzLjQxNEMyMS42NTcgMjIgMjAuNzcxIDIyIDE5IDIySDVjLTEuODg2IDAtMi44MjggMC0zLjQxNC0uNTg2QzEgMjAuODI4IDEgMTkuODg2IDEgMThWOEMxIDYuMTQgMSA1LjE3MiAxLjU4NiA0LjU4NiAyLjE3MiA0IDMuMTQgNCA1IDRoMk0xOSAxM0g1TTEyIDE3SDVNNjcgMTNIMiIvPjwvc3ZnPg==')]
                                              bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]">
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            
          <!-- Seção 3: Datas Importantes -->
<fieldset class="border bg-gray-100 border-gray-200 p-6 mb-8 rounded-2xl shadow-sm">
    <div class="space-y-6">
        <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Datas Importantes</h2>
        <hr class="border-t border-gray-100">
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Data de Nascimento -->
            <div class="space-y-2">
                <label for="nasc" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Nascimento *</label>
                <div class="relative">
                    <input type="date" name="nasc" id="nasc" required
                           class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                  shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                  transition-all duration-200
                                  hover:border-gray-300 text-gray-700 font-medium
                                  [&::-webkit-calendar-picker-indicator]:opacity-0
                                  bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0NzQ3NDciIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjN2NE0xNSA3VjN2NE0zIDVoMTZjMCAxLjg4NiAwIDIuODI4LjU4NiAzLjQxNEMyMC4xNzIgOSAyMS4xNCA5IDIzIDl2OWMwIDEuODg2IDAgMi44MjgtLjU4NiAzLjQxNEMyMS42NTcgMjIgMjAuNzcxIDIyIDE5IDIySDVjLTEuODg2IDAtMi44MjggMC0zLjQxNC0uNTg2QzEgMjAuODI4IDEgMTkuODg2IDEgMThWOEMxIDYuMTQgMSA1LjE3MiAxLjU4NiA0LjU4NiAyLjE3MiA0IDMuMTQgNCA1IDRoMk0xOSAxM0g1TTEyIDE3SDVNNjcgMTNIMiIvPjwvc3ZnPg==')]
                                  bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]">
                </div>
            </div>
            
            <!-- Data de Matrícula -->
            <div class="space-y-2">
                <label for="matricula" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Matrícula *</label>
                <div class="relative">
                    <input type="date" name="matricula" id="matricula" required
                           class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                  shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                  transition-all duration-200
                                  hover:border-gray-300 text-gray-700 font-medium
                                  [&::-webkit-calendar-picker-indicator]:opacity-0
                                  bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0NzQ3NDciIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjN2NE0xNSA3VjN2NE0zIDVoMTZjMCAxLjg4NiAwIDIuODI4LjU4NiAzLjQxNEMyMC4xNzIgOSAyMS4xNCA5IDIzIDl2OWMwIDEuODg2IDAgMi44MjgtLjU4NiAzLjQxNEMyMS42NTcgMjIgMjAuNzcxIDIyIDE5IDIySDVjLTEuODg2IDAtMi44MjggMC0zLjQxNC0uNTg2QzEgMjAuODI4IDEgMTkuODg2IDEgMThWOEMxIDYuMTQgMSA1LjE3MiAxLjU4NiA0LjU4NiAyLjE3MiA0IDMuMTQgNCA1IDRoMk0xOSAxM0g1TTEyIDE3SDVNNjcgMTNIMiIvPjwvc3ZnPg==')]
                                  bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]">
                </div>
            </div>
            
            <!-- Data de Admissão -->
            <div class="space-y-2">
                <label for="admissao" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Admissão *</label>
                <div class="relative">
                    <input type="date" name="admissao" id="admissao" required
                           class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                  shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                  transition-all duration-200
                                  hover:border-gray-300 text-gray-700 font-medium
                                  [&::-webkit-calendar-picker-indicator]:opacity-0
                                  bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0NzQ3NDciIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjN2NE0xNSA3VjN2NE0zIDVoMTZjMCAxLjg4NiAwIDIuODI4LjU4NiAzLjQxNEMyMC4xNzIgOSAyMS4xNCA5IDIzIDl2OWMwIDEuODg2IDAgMi44MjgtLjU4NiAzLjQxNEMyMS42NTcgMjIgMjAuNzcxIDIyIDE5IDIySDVjLTEuODg2IDAtMi44MjggMC0zLjQxNC0uNTg2QzEgMjAuODI4IDEgMTkuODg2IDEgMThWOEMxIDYuMTQgMSA1LjE3MiAxLjU4NiA0LjU4NiAyLjE3MiA0IDMuMTQgNCA1IDRoMk0xOSAxM0g1TTEyIDE3SDVNNjcgMTNIMiIvPjwvc3ZnPg==')]
                                  bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]">
                </div>
            </div>
            
            <!-- Previsão de Inatividade -->
            <div class="space-y-2">
                <label for="previsao_de_inatividade" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Previsão Inatividade *</label>
                <div class="relative">
                    <input type="date" name="previsao_de_inatividade" id="previsao_de_inatividade" required
                           class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                  shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                  transition-all duration-200
                                  hover:border-gray-300 text-gray-700 font-medium
                                  [&::-webkit-calendar-picker-indicator]:opacity-0
                                  bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0NzQ3NDciIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjN2NE0xNSA3VjN2NE0zIDVoMTZjMCAxLjg4NiAwIDIuODI4LjU4NiAzLjQxNEMyMC4xNzIgOSAyMS4xNCA5IDIzIDl2OWMwIDEuODg2IDAgMi44MjgtLjU4NiAzLjQxNEMyMS42NTcgMjIgMjAuNzcxIDIyIDE5IDIySDVjLTEuODg2IDAtMi44MjggMC0zLjQxNC0uNTg2QzEgMjAuODI4IDEgMTkuODg2IDEgMThWOEMxIDYuMTQgMSA1LjE3MiAxLjU4NiA0LjU4NiAyLjE3MiA0IDMuMTQgNCA1IDRoMk0xOSAxM0g1TTEyIDE3SDVNNjcgMTNIMiIvPjwvc3ZnPg==')]
                                  bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]">
                </div>
            </div>
            
            <!-- Última Promoção -->
            <div class="space-y-2">
                <label for="ultima_promocao" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Última Promoção *</label>
                <div class="relative">
                    <input type="date" name="ultima_promocao" id="ultima_promocao" required
                           class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                  shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                  transition-all duration-200
                                  hover:border-gray-300 text-gray-700 font-medium
                                  [&::-webkit-calendar-picker-indicator]:opacity-0
                                  bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0NzQ3NDciIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjN2NE0xNSA3VjN2NE0zIDVoMTZjMCAxLjg4NiAwIDIuODI4LjU4NiAzLjQxNEMyMC4xNzIgOSAyMS4xNCA5IDIzIDl2OWMwIDEuODg2IDAgMi44MjgtLjU4NiAzLjQxNEMyMS42NTcgMjIgMjAuNzcxIDIyIDE5IDIySDVjLTEuODg2IDAtMi44MjggMC0zLjQxNC0uNTg2QzEgMjAuODI4IDEgMTkuODg2IDEgMThWOEMxIDYuMTQgMSA1LjE3MiAxLjU4NiA0LjU4NiAyLjE3MiA0IDMuMTQgNCA1IDhoMk0xOSAxM0g1TTEyIDE3SDVNNjcgMTNIMiIvPjwvc3ZnPg==')]
                                  bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]">
                </div>
            </div>
        </div>
    </div>
</fieldset>

<!-- Seção 4: Documentos e Contatos -->
<fieldset class="border bg-gray-100 border-gray-200 p-6 mb-8 rounded-2xl shadow-sm">
    <div class="space-y-6">
        <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Documentos e Contatos</h2>
        <hr class="border-t border-gray-100">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- CPF -->
            <div class="space-y-2">
                <label for="cpf" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">CPF *</label>
                <input type="text" name="cpf" id="cpf" placeholder="xxx.xxx.xxx-xx" required
                       class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                              transition-all duration-200 placeholder-gray-400
                              hover:border-gray-300 text-gray-700 font-medium"
                       oninput="formatCPF(this)" onblur="validateCPF(this)" maxlength="14">
                <div class="text-red-500 text-sm mt-1 hidden" id="cpf_error">Por favor, insira um CPF válido.</div>
            </div>
            
            <!-- RG -->
            <div class="space-y-2">
                <label for="rg" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">RG *</label>
                <input type="text" name="rg" id="rg" placeholder="xx.xxxx.xxx-x" required
                       class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                              transition-all duration-200 placeholder-gray-400
                              hover:border-gray-300 text-gray-700 font-medium">
            </div>
            
            <!-- Email -->
            <div class="space-y-2">
                <label for="email" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Email *</label>
                <input type="email" name="email" id="email" placeholder="seu_usuario@policiamilitar.sp.gov.br" required 
                       class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                              transition-all duration-200 placeholder-gray-400
                              hover:border-gray-300 text-gray-700 font-medium"
                              pattern="^[\w\.-]+@policiamilitar\.sp\.gov\.br$"
                              title="O e-mail deve ter o domínio @policiamilitar.sp.gov.br">
                <div class="text-red-500 text-sm mt-1 hidden" id="email_error">O e-mail deve ter o domínio @policiamilitar.sp.gov.br.</div>
            </div>
            
            <!-- Telefone -->
            <div class="space-y-2">
                <label for="telefone" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Telefone *</label>
                <input type="tel" name="telefone" id="telefone" placeholder="(xx) xxxxx-xxxx" required
                       class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                              transition-all duration-200 placeholder-gray-400
                              hover:border-gray-300 text-gray-700 font-medium"
                       oninput="formatTelefone(this)" maxlength="15">
            </div>
            
        </div>
    </div>
</fieldset>

<!-- Seção 5: Averbação -->
<fieldset class="border bg-gray-100 border-gray-200 p-6 mb-8 rounded-2xl shadow-sm">
    <div class="space-y-6">
        <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Averbação</h2>
        <hr class="border-t border-gray-100">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- INSS -->
            <div class="space-y-2">
                <label for="tempo_para_averbar_inss" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Tempo INSS *</label>
                <input type="text" name="tempo_para_averbar_inss" id="tempo_para_averbar_inss" placeholder="Se não possuir lançar 0" value="0" required
                       class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                              transition-all duration-200 placeholder-gray-400
                              hover:border-gray-300 text-gray-700 font-medium">
            </div>
            
            <!-- Militar -->
            <div class="space-y-2">
                <label for="tempo_para_averbar_militar" class="block text-xs font-medium text-gray-500 uppercase tracking-wide">Tempo Militar *</label>
                <input type="text" name="tempo_para_averbar_militar" id="tempo_para_averbar_militar" placeholder="Se não possuir lançar 0" value="0" required
                       class="w-full pl-4 pr-4 py-3.5 rounded-xl border border-gray-200 bg-white/70
                              shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                              transition-all duration-200 placeholder-gray-400
                              hover:border-gray-300 text-gray-700 font-medium">
            </div>
        </div>
    </div>
</fieldset>

<fieldset class="border bg-gray-100 border-gray-200 p-6 mb-8 rounded-2xl shadow-sm">
    <div class="space-y-6">
        <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Imagem de Perfil e Motivo</h2>
        <hr class="border-t border-gray-100">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
            <div class="space-y-4">
                <div class="space-y-6">
                    <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Imagem de Perfil</h2>
                    <hr class="border-t border-gray-100">
                    
                    <div class="flex flex-col items-center">
                        <!-- Container da pré-visualização -->
                        <div class="relative group w-48 h-48 mb-4">
                            <div id="image-preview-container" class="w-full h-full bg-gray-50 rounded-full border-2 border-gray-200 overflow-hidden flex items-center justify-center">
                                <img id="image-preview" src="{% static 'images/default-avatar.png' %}" 
                                     class="w-full h-full object-cover rounded-full"> {% comment %} Remove hidden para sempre mostrar o placeholder {% endcomment %}
                                <span id="upload-label" class="text-gray-400 text-sm text-center p-4 {% if cadastro.image %}hidden{% endif %}">Sem imagem selecionada</span> {% comment %} Esconde label se já houver imagem {% endcomment %}
                            </div>
                            
                            <!-- Ícone de edição (aparece no hover) -->
                            <div class="absolute inset-0 bg-black bg-opacity-20 opacity-0 group-hover:opacity-100 rounded-full flex items-center justify-center transition-opacity duration-200 cursor-pointer">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Input file escondido e botão personalizado -->
                        <div class="w-full max-w-xs">
                            <label class="w-full flex items-center justify-center px-4 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white
                                          font-medium rounded-xl shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                Selecionar Imagem
                                <input type="file" name="image" id="image-upload" {% comment %} Changed ID to image-upload for clarity {% endcomment %}
                                       class="hidden"
                                       accept="image/*"
                                       required>
                            </label>
                            <div class="text-red-500 text-sm mt-1 hidden" id="image-error">Por favor, selecione uma imagem de perfil.</div>
                        </div>
                        
                        <!-- Informações adicionais -->
                        <p class="text-xs text-gray-500 mt-2 text-center">
                            Formatos aceitos: JPG, PNG (Máx. 2MB)<br>
                            Dimensões recomendadas: 300x300 pixels
                        </p>
                    </div>
                </div>
            </div>

            <div class="space-y-4 ms-8">
                <h3 class="ms-4 text-xs font-semibold text-gray-500 uppercase tracking-widest">Motivo da Alteração</h3>
                <div class="grid grid-cols-1 gap-4">
                    <div class="space-y-2">
                        <label class="ms-4 block text-xs font-medium text-gray-500 uppercase tracking-wide mb-8"></label>
                        <div class="relative w-1/2">
                            <select name="alteracao" id="alteracao"
                                    class="w-full pl-4 pr-10 py-3.5 rounded-xl border border-gray-200 bg-white/70
                                           shadow-xs focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500
                                           transition-all duration-200 appearance-none
                                           hover:border-gray-300 text-gray-700 font-medium
                                           bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTkgOWwtNyA3LTctNyIvPjwvc3ZnPg==')]
                                           bg-no-repeat bg-[right_1rem_center] bg-[length:1.5rem]"
                                    required>
                                <option value="" disabled selected>Selecione uma opção</option>
                                {% for i in alteracao %}
                                <option value="{{ i.0 }}">{{ i.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</fieldset>

<!-- Rodapé do Formulário -->
<fieldset class="bg-gray-100 p-6 mb-8 rounded-2xl">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex-1 space-y-2">
            <p class="text-xs text-gray-500 font-medium text-center md:text-left">
                * Campos obrigatórios
            </p>
        </div>
        
        <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
            <button type="submit" 
                    class="flex-1 px-6 py-3.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white 
                           font-semibold rounded-xl shadow-sm hover:shadow-md
                           transition-all duration-200 hover:scale-[1.02]
                           flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Cadastrar
            </button>
            
            <div class="flex gap-3">
                <button type="reset" 
                        class="flex-1 px-6 py-3.5 bg-gradient-to-r from-red-500 to-red-600 text-white 
                               font-semibold rounded-xl shadow-sm hover:shadow-md
                               transition-all duration-200 hover:scale-[1.02]
                               flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Limpar
                </button>
                
                <a href="{% url 'efetivo:listar_militar' %}" 
                   class="flex-1 px-6 py-3.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white 
                          font-semibold rounded-xl shadow-sm hover:shadow-md
                          transition-all duration-200 hover:scale-[1.02]
                          flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Voltar
                </a>
            </div>
        </div>
    </div>
</fieldset>

<!-- Inclui jQuery e jQuery Mask para as máscaras de input -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Previne o submit do formulário ao pressionar Enter
        document.querySelectorAll('input, select').forEach(function(element) {
            element.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                }
            });
        });
    
        // Aplica as máscaras aos campos
        $('#cpf').mask('000.000.000-00', { reverse: true });
        $('#telefone').mask('(00) 00000-0000');

        // Validação do formulário
        const militarForm = document.getElementById('militarForm');
        if (militarForm) {
            militarForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Previne o envio padrão para podermos validar
                let isValid = true;
                let firstErrorElement = null;
    
                // Remove classes de erro de validações anteriores
                document.querySelectorAll('.is-invalid').forEach(el => {
                    el.classList.remove('is-invalid', 'border-red-500');
                });
                document.querySelectorAll('.invalid-feedback').forEach(el => {
                    el.remove();
                });
                document.getElementById('cpf_error').classList.add('hidden');
                document.getElementById('email_error').classList.add('hidden');
                document.getElementById('image-error').classList.add('hidden');
    
                // Lista de campos obrigatórios
                const requiredFields = [
                    'posto_grad', 'quadro', 'grupo', 're', 'dig', 'genero', 'nome', 'nome_de_guerra',
                    'situacao',  'sgb', 'posto_secao', 'esta_adido', 'funcao', 'op_adm',
                    'prontidao', 'apresentacao_na_unidade', 'nasc', 'matricula', 'admissao',
                    'previsao_de_inatividade', 'ultima_promocao', 'cpf', 'rg', 'email',
                    'telefone', 'tempo_para_averbar_inss', 'tempo_para_averbar_militar',
                    'alteracao'
                ];
    
                // Verifica cada campo obrigatório
                requiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field) return;
    
                    const isEmpty = field.value === '' || field.value === null ||
                                    (field.tagName === 'SELECT' && field.selectedIndex <= 0);
    
                    if (isEmpty) {
                        field.classList.add('is-invalid', 'border-red-500');
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'invalid-feedback text-red-500 text-sm mt-1';
                        errorDiv.textContent = 'Este campo é obrigatório';
                        field.parentNode.appendChild(errorDiv);
                        isValid = false;
                        if (!firstErrorElement) {
                            firstErrorElement = field;
                        }
                    }
                });
    
                // Validações específicas
                const cpfField = document.getElementById('cpf');
                if (cpfField && !validateCPF(cpfField.value)) { // Use cpfField.value directly
                    addValidationError(cpfField, 'Por favor, insira um CPF válido');
                    isValid = false;
                    if (!firstErrorElement) firstErrorElement = cpfField;
                }
    
                const emailField = document.getElementById('email');
                const emailRegex = new RegExp(emailField.pattern); // Get regex from pattern attribute
                if (emailField && !emailRegex.test(emailField.value)) {
                    addValidationError(emailField, 'O e-mail deve ter o domínio @policiamilitar.sp.gov.br.');
                    isValid = false;
                    if (!firstErrorElement) firstErrorElement = emailField;
                }

                const imageUpload = document.getElementById('image-upload');
                if (imageUpload && imageUpload.files.length === 0) {
                    const imageErrorElement = document.getElementById('image-error');
                    imageUpload.classList.add('border-red-500'); // Adiciona borda vermelha ao input de arquivo se desejar
                    if (imageErrorElement) {
                        imageErrorElement.classList.remove('hidden');
                    }
                    isValid = false;
                    if (!firstErrorElement) firstErrorElement = imageUpload;
                }
    
                // Se for válido, envia o formulário
if (isValid) {
    console.log('Formulário válido, enviando...');
    militarForm.submit(); // CORREÇÃO PRINCIPAL
} else {
    // Rola até o primeiro erro
    if (firstErrorElement) {
        firstErrorElement.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
    }
    // Exibe mensagem geral de erro
    showToast('Por favor, corrija os campos destacados em vermelho', 'error');
    // Remove classe de submitting se houver erro
    militarForm.classList.remove('submitting');
}
            });
        }
    
        // Função auxiliar para adicionar erros de validação
        function addValidationError(field, message) {
            field.classList.add('is-invalid', 'border-red-500');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'invalid-feedback text-red-500 text-sm mt-1';
            errorDiv.textContent = message;
            field.parentNode.appendChild(errorDiv);
        }
    
        // Função para exibir toasts de notificação
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg text-white ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            }`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }
    
        // Função para validar CPF
        function validateCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            if (cpf === '') return false;
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            let sum = 0;
            for (let i = 1; i <= 9; i++) {
                sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);
            }
            let remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.substring(9, 10))) return false;
            sum = 0;
            for (let i = 1; i <= 10; i++) {
                sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);
            }
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.substring(10, 11))) return false;
            return true;
        }
    
        // Função para pré-visualizar a imagem
        function previewImage(event) {
            const file = event.target.files[0];
            const imagePreview = document.getElementById('image-preview');
            const uploadLabel = document.getElementById('upload-label');
            const imageErrorElement = document.getElementById('image-error');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden'); // Garante que a imagem esteja visível
                    if (uploadLabel) uploadLabel.classList.add('hidden'); // Esconde o label "Sem imagem selecionada"
                };
                reader.readAsDataURL(file);
                if (imageErrorElement) {
                    imageErrorElement.classList.add('hidden'); // Esconde mensagem de erro ao selecionar imagem
                }
            } else {
                imagePreview.src = "{% static 'images/default-avatar.png' %}"; // Volta para a imagem padrão se nenhum arquivo for selecionado
                imagePreview.classList.remove('hidden'); // Garante que a imagem padrão esteja visível
                if (uploadLabel) uploadLabel.classList.remove('hidden'); // Mostra o label novamente
            }
        }
    
        // Adiciona event listener para pré-visualizar a imagem
        const imageInput = document.getElementById('image-upload'); // ID atualizado
        if (imageInput) {
            imageInput.addEventListener('change', previewImage);
        }

        // Dados de mapeamento SGB -> Posto/Seção
        const postoSeccaoPorSGB = {
            "EM": [
                ["703150000 - CMT", "CMT"],
                ["703159000 - SUB CMT", "SUB CMT"],
                ["703159100 - SEC ADM", "SEC ADM"],
                ["703159110 - B/1 E B/5", "B/1 E B/5"],
                ["703159110-1 - B/5", "B/5"],
                ["703159120 - AA", "AA"],
                ["703159130 - B/3 E MOTOMEC", "B/3 E MOTOMEC"],
                ["703159130-1 - MOTOMEC", "MOTOMEC"],
                ["703159131 - COBOM", "COBOM"],
                ["703159140 - B/4", "B/4"],
                ["703159150 - ST UGE", "ST UGE"],
                ["703159160 - ST PJMD", "ST PJMD"],
                ["703159200 - SEC ATIV TEC", "SEC ATIV TEC"]
            ],
            "1ºSGB": [
                ["703151000 - CMT 1º SGB", "CMT 1º SGB"],
                ["703151100 - ADM PB CERRADO", "ADM PB CERRADO"],
                ["703151101 - EB CERRADO", "EB CERRADO"],
                ["703151102 - EB ZONA NORTE", "EB ZONA NORTE"],
                ["703151200 - ADM PB SANTA ROSÁLIA", "ADM PB SANTA ROSÁLIA"],
                ["703151201 - EB SANTA ROSÁLIA", "EB SANTA ROSÁLIA"],
                ["703151202 - EB ÉDEM", "EB ÉDEM"],
                ["703151300 - ADM PB VOTORANTIM", "ADM PB VOTORANTIM"],
                ["703151301 - EB VOTORANTIM", "EB VOTORANTIM"],
                ["703151302 - EB PIEDADE", "EB PIEDADE"],
                ["703151800 - ADM 1º SGB", "ADM 1º SGB"]
            ],
            "2ºSGB": [
                ["703152000 - CMT 2º SGB", "CMT 2º SGB"],
                ["703152100 - ADM PB ITU", "ADM PB ITU"],
                ["703152101 - EB ITU", "EB ITU"],
                ["703152102 - EB PORTO FELIZ", "EB PORTO FELIZ"],
                ["703152200 - ADM PB SALTO", "ADM PB SALTO"],
                ["703152201 - EB SALTO", "EB SALTO"],
                ["703152300 - ADM PB SÃO ROQUE", "ADM PB SÃO ROQUE"],
                ["703152301 - EB SÃO ROQUE", "EB SÃO ROQUE"],
                ["703152302 - EB IBIÚNA", "EB IBIÚNA"],
                ["703152800 - ADM 2º SGB", "ADM 2º SGB"],
                ["703152900 - NUCL ATIV TEC 2º SGB", "NUCL ATIV TEC 2º SGB"]
            ],
            "3ºSGB": [
                ["703153000 - CMT 3º SGB", "CMT 3º SGB"],
                ["703153100 - ADM PB ITAPEVA", "ADM PB ITAPEVA"],
                ["703153101 - EB ITAPEVA", "EB ITAPEVA"],
                ["703153102 - EB APIAÍ", "EB APIAÍ"],
                ["703153103 - EB ITARARÉ", "EB ITARARÉ"],
                ["703153104 - EB CAPÃO BONITO", "EB CAPÃO BONITO"],
                ["703153800 - ADM 3º SGB", "ADM 3º SGB"],
                ["703153900 - NUCL ATIV TEC 3º SGB", "NUCL ATIV TEC 3º SGB"]
            ],
            "4ºSGB": [
                ["703154000 - CMT 4º SGB", "CMT 4º SGB"],
                ["703154100 - ADM PB ITAPETININGA", "ADM PB ITAPETININGA"],
                ["703154101 - EB ITAPETININGA", "EB ITAPETININGA"],
                ["703154102 - EB BOITUVA", "EB BOITUVA"],
                ["703154103 - EB ANGATUBA", "EB ANGATUBA"],
                ["703154200 - ADM PB TATUÍ", "ADM PB TATUÍ"],
                ["703154201 - EB TATUÍ", "EB TATUÍ"],
                ["703154202 - EB TIETÊ", "EB TIETÊ"],
                ["703154203 - EB LARANJAL PAULISTA", "EB LARANJAL PAULISTA"],
                ["703154800 - ADM 4º SGB", "ADM 4º SGB"],
                ["703154900 - NUCL ATIV TEC 4º SGB", "NUCL ATIV TEC 4º SGB"]
            ],
            "5ºSGB": [
                ["703155000 - CMT 5º SGB", "CMT 5º SGB"],
                ["703155100 - ADM PB BOTUCATU", "ADM PB BOTUCATU"],
                ["703155101 - EB BOTUCATU", "EB BOTUCATU"],
                ["703155102 - EB ITATINGA", "EB ITATINGA"],
                ["703155200 - ADM PB AVARÉ", "ADM PB AVARÉ"],
                ["703155201 - EB AVARÉ", "EB AVARÉ"],
                ["703155202 - EB PIRAJU", "EB PIRAJU"],
                ["703155203 - EB ITAÍ", "EB ITAÍ"],
                ["703155800 - ADM 5º SGB", "ADM 5º SGB"],
                ["703155900 - NUCL ATIV TEC 5º SGB", "NUCL ATIV TEC 5º SGB"]
            ]
        };
    
        // Função para atualizar as opções do Posto/Seção
        function atualizarPostoSeccao() {
            const sgbSelect = document.getElementById('sgb');
            const postoSeccaoSelect = document.getElementById('posto_secao');
            const sgbSelecionado = sgbSelect.value;
    
            postoSeccaoSelect.innerHTML = '<option value="" disabled selected>Selecione o Posto/Seção</option>';
            postoSeccaoSelect.disabled = !sgbSelecionado;
    
            if (sgbSelecionado && postoSeccaoPorSGB[sgbSelecionado]) {
                postoSeccaoPorSGB[sgbSelecionado].forEach(([value, label]) => {
                    const option = new Option(label, value);
                    postoSeccaoSelect.add(option);
                });
            }
        }
    
        // Inicializar o select de Posto/Seção como desabilitado
        const postoSeccaoSelectElement = document.getElementById('posto_secao');
        if (postoSeccaoSelectElement) {
            postoSeccaoSelectElement.disabled = true;
        }

        // Adicionar o event listener para o select de SGB
        const sgbSelectElement = document.getElementById('sgb');
        if (sgbSelectElement) {
            sgbSelectElement.addEventListener('change', atualizarPostoSeccao);
            // Se já houver um valor selecionado no SGB, atualizar as opções
            if (sgbSelectElement.value) {
                atualizarPostoSeccao();
            }
        }

        // Adiciona animação de hover nos botões
        document.querySelectorAll('button, a[href]').forEach(button => {
            button.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-1px)';
            });
            button.addEventListener('mouseleave', function() {
                this.style.transform = '';
            });
        });
    });
</script>
{% endblock 'body' %}
